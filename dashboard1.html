<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlacementPro – Student Dashboard</title>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #070b14;
      --surface: #0d1424;
      --surface2: #121c30;
      --surface3: #182236;
      --border: #1e2d48;
      --accent: #4f8ef7;
      --accent2: #00d4aa;
      --purple: #8b5cf6;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #f43f5e;
      --text: #e8f0fe;
      --text2: #8da4c8;
      --text3: #3d5a80;
      --grad: linear-gradient(135deg, #4f8ef7 0%, #00d4aa 100%);
      --grad2: linear-gradient(135deg, #8b5cf6 0%, #4f8ef7 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      overflow-x: hidden;
    }

    code {
      font-family: 'JetBrains Mono', monospace;
    }

    ::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 10px;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(120%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: .4;
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }

      100% {
        background-position: 200% 0;
      }
    }

    @keyframes glow {

      0%,
      100% {
        box-shadow: 0 0 8px rgba(79, 142, 247, 0.3);
      }

      50% {
        box-shadow: 0 0 20px rgba(79, 142, 247, 0.6);
      }
    }

    @keyframes countUp {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* ═══════════ SIDEBAR ═══════════ */
    .sidebar {
      width: 256px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      z-index: 200;
      transition: width 0.3s;
    }

    .sidebar-header {
      padding: 22px 18px 18px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-header .logo-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: var(--grad);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      animation: glow 3s ease-in-out infinite;
    }

    .sidebar-header .logo-text h2 {
      font-size: 15px;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .sidebar-header .logo-text span {
      font-size: 11px;
      color: var(--text3);
    }

    .nav-group {
      padding: 14px 10px 4px;
    }

    .nav-group-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text3);
      padding: 0 10px;
      margin-bottom: 4px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 13.5px;
      font-weight: 500;
      color: var(--text2);
      transition: all 0.18s;
      margin-bottom: 1px;
      position: relative;
    }

    .nav-item:hover {
      background: var(--surface2);
      color: var(--text);
    }

    .nav-item.active {
      background: rgba(79, 142, 247, 0.12);
      color: var(--accent);
    }

    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 20%;
      bottom: 20%;
      width: 3px;
      border-radius: 0 3px 3px 0;
      background: var(--accent);
    }

    .nav-icon {
      font-size: 15px;
      width: 22px;
      text-align: center;
      flex-shrink: 0;
    }

    .nav-badge {
      margin-left: auto;
      background: var(--danger);
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 20px;
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 14px 16px;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      background: var(--grad2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 13px;
      flex-shrink: 0;
    }

    .user-info .name {
      font-size: 13px;
      font-weight: 600;
    }

    .user-info .role {
      font-size: 11px;
      color: var(--text3);
    }

    .logout-btn {
      margin-left: auto;
      background: none;
      border: none;
      color: var(--text3);
      cursor: pointer;
      font-size: 17px;
      padding: 5px;
      border-radius: 7px;
      transition: all 0.2s;
    }

    .logout-btn:hover {
      background: rgba(244, 63, 94, 0.1);
      color: var(--danger);
    }

    /* ═══════════ MAIN ═══════════ */
    .main {
      margin-left: 256px;
      min-height: 100vh;
      flex: 1;
      background: var(--bg);
    }

    .topbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(7, 11, 20, 0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0 32px;
      height: 62px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .topbar-left h1 {
      font-size: 17px;
      font-weight: 700;
    }

    .topbar-left p {
      font-size: 12px;
      color: var(--text3);
      margin-top: 1px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Notification bell */
    .notif-btn {
      position: relative;
      background: none;
      border: none;
      color: var(--text2);
      font-size: 18px;
      cursor: pointer;
      padding: 6px;
      border-radius: 9px;
      transition: all 0.2s;
    }

    .notif-btn:hover {
      background: var(--surface2);
      color: var(--text);
    }

    .notif-dot {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--danger);
      border: 2px solid var(--bg);
      animation: pulse 2s infinite;
    }

    /* ═══════════ PAGE ═══════════ */
    .page {
      display: none;
      padding: 28px 32px;
      animation: fadeUp 0.35s ease;
    }

    .page.active {
      display: block;
    }

    /* ═══════════ BUTTONS ═══════════ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 9px 18px;
      border-radius: 9px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.18s;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--grad);
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.88;
      transform: translateY(-1px);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text2);
    }

    .btn-outline:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn-danger {
      background: rgba(244, 63, 94, 0.1);
      color: var(--danger);
      border: 1px solid rgba(244, 63, 94, 0.2);
    }

    .btn-success {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .btn-purple {
      background: rgba(139, 92, 246, 0.12);
      color: var(--purple);
      border: 1px solid rgba(139, 92, 246, 0.2);
    }

    .btn-cyan {
      background: rgba(0, 212, 170, 0.1);
      color: var(--accent2);
      border: 1px solid rgba(0, 212, 170, 0.2);
    }

    .btn-sm {
      padding: 5px 11px;
      font-size: 12px;
      border-radius: 7px;
    }

    .btn-icon {
      padding: 7px;
      width: 32px;
      height: 32px;
      justify-content: center;
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      transform: none !important;
    }

    /* ═══════════ CARDS ═══════════ */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px;
      margin-bottom: 20px;
    }

    .card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 18px;
      gap: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 700;
    }

    .card-sub {
      font-size: 12px;
      color: var(--text2);
      margin-top: 3px;
    }

    .card-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    /* ═══════════ STAT CARDS ═══════════ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px;
      position: relative;
      overflow: hidden;
      transition: border-color 0.2s, transform 0.2s;
      cursor: default;
    }

    .stat-card:hover {
      border-color: rgba(79, 142, 247, 0.35);
      transform: translateY(-2px);
    }

    .stat-card .accent-line {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      border-radius: 16px 16px 0 0;
    }

    .stat-card .sc-icon {
      font-size: 22px;
      margin-bottom: 12px;
    }

    .stat-card .sc-value {
      font-size: 30px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      line-height: 1;
      animation: countUp 0.5s ease;
    }

    .stat-card .sc-label {
      font-size: 12px;
      color: var(--text2);
      margin-top: 6px;
    }

    .stat-card .sc-sub {
      font-size: 11px;
      color: var(--text3);
      margin-top: 5px;
    }

    /* ═══════════ BADGES ═══════════ */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 9px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }

    .b-blue {
      background: rgba(79, 142, 247, 0.12);
      color: var(--accent);
    }

    .b-green {
      background: rgba(34, 197, 94, 0.12);
      color: var(--success);
    }

    .b-yellow {
      background: rgba(245, 158, 11, 0.12);
      color: var(--warning);
    }

    .b-red {
      background: rgba(244, 63, 94, 0.12);
      color: var(--danger);
    }

    .b-purple {
      background: rgba(139, 92, 246, 0.12);
      color: var(--purple);
    }

    .b-cyan {
      background: rgba(0, 212, 170, 0.12);
      color: var(--accent2);
    }

    .b-gray {
      background: rgba(141, 164, 200, 0.1);
      color: var(--text3);
    }

    /* ═══════════ APPLICATION STATUS PIPELINE ═══════════ */
    .status-pipeline {
      display: flex;
      align-items: center;
      gap: 0;
      padding: 14px 0;
      overflow-x: auto;
    }

    .pipe-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 80px;
      gap: 6px;
      position: relative;
    }

    .pipe-step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 15px;
      left: calc(50% + 14px);
      width: calc(100% - 28px);
      height: 2px;
      background: var(--border);
      border-radius: 2px;
    }

    .pipe-step.done:not(:last-child)::after {
      background: var(--success);
    }

    .pipe-step.active-step:not(:last-child)::after {
      background: var(--accent);
    }

    .pipe-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      transition: all 0.3s;
      background: var(--surface2);
      border: 2px solid var(--border);
      color: var(--text3);
      z-index: 1;
    }

    .pipe-step.done .pipe-dot {
      background: rgba(34, 197, 94, 0.15);
      border-color: var(--success);
      color: var(--success);
    }

    .pipe-step.active-step .pipe-dot {
      background: rgba(79, 142, 247, 0.15);
      border-color: var(--accent);
      color: var(--accent);
      animation: glow 2s infinite;
    }

    .pipe-step.rejected .pipe-dot {
      background: rgba(244, 63, 94, 0.1);
      border-color: var(--danger);
      color: var(--danger);
    }

    .pipe-label {
      font-size: 10px;
      color: var(--text3);
      text-align: center;
      line-height: 1.3;
      white-space: nowrap;
    }

    .pipe-step.done .pipe-label {
      color: var(--success);
    }

    .pipe-step.active-step .pipe-label {
      color: var(--accent);
      font-weight: 600;
    }

    /* ═══════════ DRIVE CARD (student view) ═══════════ */
    .drive-feed {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .drive-card-s {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      transition: border-color 0.2s, transform 0.2s;
      position: relative;
      overflow: hidden;
    }

    .drive-card-s::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--grad);
      border-radius: 16px 16px 0 0;
    }

    .drive-card-s:hover {
      border-color: rgba(79, 142, 247, 0.35);
      transform: translateY(-2px);
    }

    .drive-card-s.status-active::before {
      background: var(--grad);
    }

    .drive-card-s.status-upcoming::before {
      background: linear-gradient(135deg, #8b5cf6, #4f8ef7);
    }

    .dc-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
      gap: 10px;
    }

    .dc-company {
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dc-company-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: var(--surface2);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .dc-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      margin-bottom: 12px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 10px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text2);
    }

    .chip strong {
      color: var(--text);
    }

    .dc-desc {
      font-size: 13px;
      color: var(--text2);
      margin-bottom: 14px;
      line-height: 1.6;
    }

    .dc-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }

    .dc-deadline {
      font-size: 11.5px;
      color: var(--text3);
    }

    .dc-deadline strong {
      color: var(--warning);
    }

    .dc-actions {
      display: flex;
      gap: 7px;
    }

    /* ═══════════ APPLICATION TRACKER CARD ═══════════ */
    .app-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px 20px;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      transition: border-color 0.2s;
    }

    .app-card:hover {
      border-color: rgba(79, 142, 247, 0.25);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .app-company {
      font-size: 14px;
      font-weight: 700;
    }

    .app-usn {
      font-size: 11px;
      color: var(--text3);
      font-family: 'JetBrains Mono', monospace;
    }

    /* Application status badge */
    .app-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 11px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
    }

    .s-eligible {
      background: rgba(141, 164, 200, 0.1);
      color: var(--text3);
      border: 1px solid rgba(141, 164, 200, 0.15);
    }

    .s-applied {
      background: rgba(79, 142, 247, 0.1);
      color: var(--accent);
      border: 1px solid rgba(79, 142, 247, 0.2);
    }

    .s-shortlisted {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .s-selected {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .s-rejected {
      background: rgba(244, 63, 94, 0.1);
      color: var(--danger);
      border: 1px solid rgba(244, 63, 94, 0.2);
    }

    /* ═══════════ ASSESSMENT CARD ═══════════ */
    .assess-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 10px;
      transition: border-color 0.2s, transform 0.2s;
    }

    .assess-card:hover {
      border-color: rgba(139, 92, 246, 0.3);
      transform: translateY(-1px);
    }

    .assess-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
    }

    .assess-title {
      font-size: 14px;
      font-weight: 700;
    }

    .assess-meta {
      display: flex;
      gap: 7px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .assess-result {
      margin-top: 10px;
    }

    .result-bar {
      height: 6px;
      background: var(--surface2);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 6px;
    }

    .result-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.8s ease;
    }

    /* ═══════════ PROFILE ═══════════ */
    .profile-hero {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .profile-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 90px;
      background: var(--grad);
      opacity: 0.08;
      border-radius: 20px 20px 0 0;
    }

    .profile-avatar {
      width: 72px;
      height: 72px;
      border-radius: 18px;
      background: var(--grad2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 16px;
      border: 3px solid var(--surface);
      position: relative;
    }

    .profile-name {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .profile-usn {
      font-size: 12px;
      color: var(--text3);
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 12px;
    }

    .profile-chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .profile-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
    }

    .profile-section h3 {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--text3);
      margin-bottom: 14px;
    }

    .profile-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 9px 0;
      border-bottom: 1px solid rgba(30, 45, 72, 0.4);
      font-size: 13px;
    }

    .profile-row:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .profile-row .label {
      color: var(--text3);
    }

    .profile-row .value {
      color: var(--text);
      font-weight: 600;
      text-align: right;
    }

    /* ═══════════ FORM ═══════════ */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .form-full {
      grid-column: 1 / -1;
    }

    .field {
      margin-bottom: 0;
    }

    .field label {
      display: block;
      font-size: 11.5px;
      color: var(--text2);
      margin-bottom: 6px;
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    .field input,
    .field select,
    .field textarea {
      width: 100%;
      padding: 10px 13px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 9px;
      color: var(--text);
      font-family: inherit;
      font-size: 13px;
      transition: border-color 0.2s;
    }

    .field input:focus,
    .field select:focus,
    .field textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(79, 142, 247, 0.08);
    }

    .field textarea {
      resize: vertical;
      min-height: 72px;
    }

    .field select option {
      background: var(--surface2);
    }

    /* ═══════════ MODAL ═══════════ */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(5px);
      z-index: 500;
      align-items: center;
      justify-content: center;
    }

    .overlay.show {
      display: flex;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      width: 92%;
      max-width: 580px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 30px;
      animation: fadeUp 0.3s ease;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 22px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text3);
      font-size: 18px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: var(--surface2);
      color: var(--text);
    }

    .modal-footer {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 22px;
      padding-top: 18px;
      border-top: 1px solid var(--border);
    }

    /* ═══════════ QUIZ ENGINE ═══════════ */
    .quiz-wrap {
      max-width: 680px;
      margin: 0 auto;
    }

    .quiz-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .quiz-timer {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--surface2);
      border: 1px solid var(--border);
      padding: 8px 18px;
      border-radius: 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 20px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 16px;
    }

    .quiz-timer.warn {
      color: var(--danger);
      border-color: rgba(244, 63, 94, 0.3);
      animation: pulse 1s infinite;
    }

    .quiz-progress {
      height: 4px;
      background: var(--surface2);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .quiz-progress-fill {
      height: 100%;
      background: var(--grad);
      border-radius: 2px;
      transition: width 0.4s;
    }

    .q-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      animation: fadeUp 0.3s ease;
    }

    .q-num {
      font-size: 11px;
      color: var(--text3);
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .q-text {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.6;
      margin-bottom: 18px;
    }

    .q-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .q-opt {
      padding: 12px 16px;
      border-radius: 10px;
      border: 1.5px solid var(--border);
      background: var(--surface2);
      cursor: pointer;
      font-size: 13.5px;
      color: var(--text2);
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .q-opt:hover {
      border-color: var(--accent);
      color: var(--text);
      background: rgba(79, 142, 247, 0.06);
    }

    .q-opt.selected {
      border-color: var(--accent);
      background: rgba(79, 142, 247, 0.1);
      color: var(--text);
    }

    .q-opt.correct {
      border-color: var(--success);
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
    }

    .q-opt.wrong {
      border-color: var(--danger);
      background: rgba(244, 63, 94, 0.08);
      color: var(--danger);
    }

    .q-opt-letter {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: var(--surface3);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* Quiz result */
    .quiz-result {
      text-align: center;
      padding: 40px 20px;
      animation: fadeUp 0.5s ease;
    }

    .result-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: var(--grad);
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: 800;
      box-shadow: 0 0 30px rgba(79, 142, 247, 0.3);
    }

    .result-circle.fail {
      background: linear-gradient(135deg, var(--warning), var(--danger));
    }

    /* ═══════════ NOTIFICATIONS ═══════════ */
    .notif-panel {
      position: fixed;
      top: 62px;
      right: 20px;
      width: 340px;
      max-height: 480px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5);
      z-index: 300;
      display: none;
      animation: slideIn 0.25s ease;
    }

    .notif-panel.show {
      display: block;
    }

    .notif-panel-header {
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .notif-panel-header h3 {
      font-size: 14px;
      font-weight: 700;
    }

    .notif-list {
      overflow-y: auto;
      max-height: 400px;
    }

    .notif-item {
      padding: 13px 18px;
      border-bottom: 1px solid rgba(30, 45, 72, 0.4);
      cursor: pointer;
      transition: background 0.15s;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .notif-item:hover {
      background: var(--surface2);
    }

    .notif-item.unread {
      background: rgba(79, 142, 247, 0.04);
    }

    .notif-icon {
      width: 32px;
      height: 32px;
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .notif-body .notif-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .notif-body .notif-msg {
      font-size: 11.5px;
      color: var(--text2);
      line-height: 1.5;
    }

    .notif-body .notif-time {
      font-size: 10.5px;
      color: var(--text3);
      margin-top: 3px;
    }

    .notif-unread-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      flex-shrink: 0;
      margin-top: 5px;
    }

    /* ═══════════ TOAST ═══════════ */
    .toast-wrap {
      position: fixed;
      top: 18px;
      right: 18px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }

    .toast {
      background: var(--surface);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      border-radius: 12px;
      padding: 13px 16px;
      min-width: 270px;
      max-width: 340px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
      animation: slideIn 0.3s ease;
      pointer-events: all;
    }

    .toast.s {
      border-left-color: var(--success);
    }

    .toast.e {
      border-left-color: var(--danger);
    }

    .toast.w {
      border-left-color: var(--warning);
    }

    .toast-t {
      font-size: 13px;
      font-weight: 700;
    }

    .toast-m {
      font-size: 12px;
      color: var(--text2);
      margin-top: 2px;
    }

    /* ═══════════ MISC ═══════════ */
    .loader {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      display: inline-block;
    }

    .empty {
      text-align: center;
      padding: 52px 24px;
      color: var(--text3);
    }

    .empty .e-icon {
      font-size: 38px;
      margin-bottom: 12px;
    }

    .empty p {
      font-size: 14px;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 18px 0;
    }

    .section-gap {
      margin-bottom: 24px;
    }

    .prog-bar {
      height: 5px;
      background: var(--surface2);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 6px;
    }

    .prog-fill {
      height: 100%;
      background: var(--grad);
      border-radius: 3px;
      transition: width 0.6s ease;
    }

    .section-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 14px;
    }

    /* Welcome banner */
    .welcome-banner {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px 24px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      position: relative;
      overflow: hidden;
    }

    .welcome-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 4px;
      background: var(--grad);
    }

    .wb-left {
      padding-left: 8px;
    }

    .wb-greeting {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .wb-sub {
      font-size: 13px;
      color: var(--text2);
    }

    .wb-cgpa {
      text-align: right;
    }

    .wb-cgpa .cgpa-val {
      font-size: 34px;
      font-weight: 800;
      background: var(--grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
    }

    .wb-cgpa .cgpa-lbl {
      font-size: 11px;
      color: var(--text3);
      margin-top: 3px;
    }

    /* Empty state with illustration */
    .empty-fancy {
      text-align: center;
      padding: 60px 24px;
    }

    .empty-fancy .ef-icon {
      font-size: 52px;
      margin-bottom: 14px;
      opacity: 0.7;
    }

    .empty-fancy h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .empty-fancy p {
      font-size: 13px;
      color: var(--text2);
    }

    /* ═══════════ RESPONSIVE ═══════════ */
    @media (max-width: 900px) {
      .sidebar {
        width: 0;
        overflow: hidden;
      }

      .main {
        margin-left: 0;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }

      .profile-grid {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .page {
        padding: 18px 16px;
      }
    }

    /* ═══════════════════════════════════════
       RESUME WIZARD STYLES
    ═══════════════════════════════════════ */
    .rw-step-progress {
      display: flex;
      align-items: center;
      margin-bottom: 28px;
      flex-wrap: wrap;
      gap: 4px;
    }

    .rw-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .rw-step-circle {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: var(--surface2);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--text2);
      transition: all 0.3s;
    }

    .rw-step.active .rw-step-circle {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .rw-step.done .rw-step-circle {
      background: var(--success);
      border-color: var(--success);
      color: #fff;
    }

    .rw-step-label {
      font-size: 10px;
      color: var(--text2);
      white-space: nowrap;
    }

    .rw-step.active .rw-step-label {
      color: var(--accent);
      font-weight: 600;
    }

    .rw-step-line {
      flex: 1;
      height: 2px;
      background: var(--border);
      min-width: 16px;
    }

    .rw-panel {
      display: none;
      animation: rwSlideUp 0.3s ease;
    }

    .rw-panel.active {
      display: block;
    }

    @keyframes rwSlideUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .rw-panel-header {
      margin-bottom: 20px;
    }

    .rw-panel-header h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
    }

    .rw-panel-header p {
      font-size: 13px;
      color: var(--text2);
      margin-top: 4px;
    }

    .rw-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-bottom: 14px;
    }

    .rw-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rw-field label {
      font-size: 12px;
      color: var(--text2);
      font-weight: 600;
    }

    .rw-full {
      grid-column: 1 / -1;
    }

    .rw-input {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      padding: 10px 14px;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      transition: border-color 0.2s, box-shadow 0.2s;
      width: 100%;
    }

    .rw-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(79, 142, 247, 0.12);
    }

    .rw-input option {
      background: var(--surface2);
    }

    .rw-sub {
      margin-bottom: 20px;
    }

    .rw-sub h3 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 12px;
    }

    .rw-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .rw-card-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .rw-card-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
    }

    .rw-remove-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text2);
      cursor: pointer;
      padding: 2px 8px;
      font-size: 12px;
      transition: 0.2s;
    }

    .rw-remove-btn:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    .rw-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 24px;
    }

    /* Templates */
    .rw-template-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 16px;
    }

    .rw-template-card {
      background: var(--surface2);
      border: 2px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
    }

    .rw-template-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .rw-template-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(79, 142, 247, 0.15);
    }

    .rw-template-preview {
      height: 160px;
      padding: 10px;
      overflow: hidden;
      position: relative;
    }

    .rw-tpl-info {
      padding: 10px 12px;
      border-top: 1px solid var(--border);
    }

    .rw-tpl-name {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
    }

    .rw-tpl-desc {
      font-size: 11px;
      color: var(--text2);
      margin-top: 3px;
    }

    .rw-selected-notice {
      font-size: 13px;
      color: var(--text2);
      margin-bottom: 8px;
    }

    /* Classic preview */
    .rw-preview-classic {
      background: #fff;
      font-family: serif;
    }

    .rtp-name {
      font-size: 11px;
      font-weight: 900;
      text-align: center;
      color: #000;
      letter-spacing: 1px;
    }

    .rtp-role {
      font-size: 7px;
      text-align: center;
      color: #333;
      margin-bottom: 3px;
    }

    .rtp-contact {
      font-size: 6px;
      text-align: center;
      color: #555;
    }

    .rtp-hr {
      border-top: 1px solid #000;
      margin: 3px 0;
    }

    .rtp-section {
      font-size: 7px;
      font-weight: 700;
      color: #000;
      background: #e8e8e8;
      padding: 1px 4px;
      margin: 3px 0 1px;
    }

    .rtp-bold {
      font-size: 7px;
      font-weight: 700;
      color: #000;
    }

    .rtp-text {
      font-size: 6px;
      color: #333;
      line-height: 1.3;
    }

    /* Modern preview */
    .rw-preview-modern {
      background: #fff;
      padding: 0;
    }

    .rtp-modern-head {
      background: #1A237E;
      padding: 8px;
      text-align: center;
    }

    .rtp-college {
      font-size: 5px;
      color: rgba(255, 255, 255, 0.7);
      letter-spacing: 0.5px;
    }

    .rtp-name-mod {
      font-size: 11px;
      font-weight: 900;
      color: #fff;
    }

    .rtp-role-mod {
      font-size: 6px;
      color: rgba(255, 255, 255, 0.8);
    }

    .rtp-mod-section {
      font-size: 7px;
      font-weight: 700;
      color: #1A237E;
      margin: 4px 6px 1px;
    }

    .rtp-hr2 {
      border-top: 1px solid #1A237E;
      margin: 0 6px 2px;
    }

    /* Sidebar preview */
    .rw-preview-sidebar {
      display: flex;
      padding: 0;
      background: #fff;
    }

    .rtp-sidebar-left {
      background: #1a2236;
      width: 40%;
      padding: 6px;
    }

    .rtp-sb-head {
      font-size: 5px;
      font-weight: 700;
      color: #06b6d4;
      letter-spacing: 0.5px;
      margin-bottom: 2px;
      margin-top: 4px;
    }

    .rtp-sb-item {
      font-size: 5.5px;
      color: #cbd5e1;
      margin-bottom: 1px;
    }

    .rtp-sidebar-right {
      flex: 1;
      padding: 6px;
    }

    .rtp-sb-topbar {
      font-size: 9px;
      font-weight: 900;
      color: #000;
    }

    .rtp-sb-sub {
      font-size: 5.5px;
      color: #555;
    }

    .rtp-sb-section {
      font-size: 6.5px;
      font-weight: 700;
      color: #1a2236;
      margin-top: 5px;
    }

    .rtp-sb-line {
      border-top: 1px solid #06b6d4;
      margin: 1px 0 2px;
    }

    /* Career Dashboard */
    .rw-dashboard-setup {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .rw-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 32px;
      color: var(--text2);
    }

    .rw-loading.hidden {
      display: none !important;
    }

    .rw-spinner {
      width: 36px;
      height: 36px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    .rw-dash-section {
      margin-bottom: 24px;
    }

    .rw-dash-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 14px;
    }

    .rw-score-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }

    .rw-gauge-area {
      flex-shrink: 0;
      position: relative;
    }

    .rw-gauge-wrap {
      position: relative;
      display: inline-block;
    }

    .rw-score-svg {
      width: 130px;
      height: 130px;
    }

    .rw-grade-badge {
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      padding: 2px 12px;
      border-radius: 20px;
    }

    .rw-breakdown-area {
      flex: 1;
      min-width: 200px;
    }

    .rw-breakdown-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text2);
      margin-bottom: 10px;
    }

    .rw-bar-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .rw-bar-lbl {
      font-size: 12px;
      color: var(--text2);
      width: 160px;
      flex-shrink: 0;
    }

    .rw-bar-track {
      flex: 1;
      background: var(--surface3);
      border-radius: 4px;
      height: 8px;
      overflow: hidden;
    }

    .rw-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1s ease;
      width: 0%;
    }

    .rw-bar-score {
      font-size: 11px;
      color: var(--text2);
      width: 40px;
      text-align: right;
      flex-shrink: 0;
    }

    .rw-score-tip {
      font-size: 12px;
      color: var(--text2);
      margin-top: 12px;
      line-height: 1.5;
    }

    .rw-market-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
    }

    .rw-market-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 14px;
    }

    .rw-mstat {
      background: var(--surface3);
      border-radius: 10px;
      padding: 12px;
      text-align: center;
    }

    .rw-mstat-num {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
    }

    .rw-mstat-lbl {
      font-size: 11px;
      color: var(--text2);
      margin-top: 4px;
    }

    .rw-market-banner {
      background: rgba(79, 142, 247, 0.08);
      border: 1px solid rgba(79, 142, 247, 0.2);
      border-radius: 10px;
      padding: 10px 14px;
      margin-bottom: 14px;
      font-size: 13px;
      color: var(--text);
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .rw-skill-gap-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text2);
      margin-bottom: 10px;
    }

    .rw-skill-gap-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .rw-skill-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .rw-skill-name {
      width: 120px;
      font-size: 12px;
      color: var(--text2);
      flex-shrink: 0;
    }

    .rw-skill-bar-wrap {
      flex: 1;
      background: var(--surface3);
      border-radius: 4px;
      height: 8px;
      overflow: hidden;
    }

    .rw-skill-bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.8s ease;
      width: 0%;
    }

    .rw-skill-pct {
      font-size: 11px;
      color: var(--text2);
      width: 32px;
      text-align: right;
      flex-shrink: 0;
    }

    .rw-skill-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 10px;
      flex-shrink: 0;
    }

    .rw-skill-badge.have {
      background: rgba(34, 197, 94, 0.12);
      color: var(--success);
    }

    .rw-skill-badge.missing {
      background: rgba(244, 63, 94, 0.12);
      color: var(--danger);
    }

    .rw-path-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
    }

    .rw-path-timeline {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .rw-path-step {
      display: flex;
      gap: 14px;
    }

    .rw-path-node {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      background: var(--surface3);
      border: 2px solid var(--border);
      color: var(--text2);
    }

    .rw-path-node.current {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .rw-path-week {
      font-size: 11px;
      color: var(--text2);
      font-weight: 600;
    }

    .rw-path-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
    }

    .rw-path-desc {
      font-size: 12px;
      color: var(--text2);
      line-height: 1.5;
    }

    .rw-courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
    }

    .rw-course-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      text-decoration: none;
      color: var(--text);
      transition: 0.2s;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rw-course-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .rw-course-badge {
      font-size: 10px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 8px;
      display: inline-block;
      background: var(--surface3);
      color: var(--text2);
    }

    .rw-course-title {
      font-size: 13px;
      font-weight: 600;
      line-height: 1.4;
    }

    .rw-course-meta {
      font-size: 11px;
      color: var(--text2);
    }

    .rw-course-reason {
      font-size: 11px;
      color: var(--text2);
      font-style: italic;
    }

    .rw-course-cta {
      font-size: 12px;
      color: var(--accent);
      font-weight: 600;
      margin-top: auto;
    }

    .rw-courses-alert {
      background: rgba(244, 63, 94, 0.08);
      border: 1px solid rgba(244, 63, 94, 0.2);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 13px;
      margin-bottom: 14px;
    }

    .rw-courses-alert-green {
      background: rgba(34, 197, 94, 0.08);
      border-color: rgba(34, 197, 94, 0.2);
    }

    /* Step 7 */
    .rw-action-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    .rw-action-icon {
      font-size: 36px;
      flex-shrink: 0;
    }

    .rw-action-content h3 {
      font-size: 15px;
      font-weight: 700;
    }

    .rw-action-content p {
      font-size: 13px;
      color: var(--text2);
      margin-top: 4px;
    }

    .rw-success-banner {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 13px;
      color: var(--success);
      margin-bottom: 16px;
    }

    .rw-compare-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .rw-compare-header h3 {
      font-size: 15px;
      font-weight: 700;
    }

    .rw-ai-badge {
      font-size: 11px;
      background: rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.3);
      color: var(--purple);
      padding: 3px 10px;
      border-radius: 20px;
      font-weight: 600;
    }

    .rw-results-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 16px 0;
    }

    .rw-match-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      flex-shrink: 0;
    }

    .rw-match-circle span:first-child {
      font-size: 22px;
    }

    .rw-match-label {
      font-size: 9px;
      opacity: 0.8;
    }

    .rw-benchmark-box {
      background: var(--surface3);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 14px;
    }

    .rw-benchmark-box h4 {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .rw-results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-bottom: 14px;
    }

    .rw-col {
      background: var(--surface3);
      border-radius: 10px;
      padding: 14px;
    }

    .rw-col h4 {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .rw-col ul,
    .rw-col ol {
      padding-left: 18px;
    }

    .rw-col li {
      font-size: 12px;
      color: var(--text2);
      margin-bottom: 4px;
      line-height: 1.5;
    }

    .rw-strengths {
      border-top: 3px solid var(--success);
    }

    .rw-gaps {
      border-top: 3px solid var(--danger);
    }

    .rw-action-items {
      background: var(--surface3);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 14px;
    }

    .rw-action-items h4 {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .rw-action-items ol {
      padding-left: 18px;
    }

    .rw-action-items li {
      font-size: 12px;
      color: var(--text2);
      margin-bottom: 4px;
      line-height: 1.5;
    }

    .rw-verdict {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.25);
      border-radius: 10px;
      padding: 14px;
    }

    .rw-verdict h4 {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--purple);
    }

    .rw-verdict p {
      font-size: 13px;
      color: var(--text);
      line-height: 1.6;
    }

    @media (max-width: 768px) {

      .rw-form-grid,
      .rw-template-grid,
      .rw-results-grid,
      .rw-market-stats {
        grid-template-columns: 1fr;
      }

      .rw-action-card {
        flex-wrap: wrap;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

  <!-- TOAST -->
  <div class="toast-wrap" id="toast-wrap"></div>

  <!-- NOTIFICATION PANEL -->
  <div class="notif-panel" id="notif-panel">
    <div class="notif-panel-header">
      <h3>🔔 Notifications</h3>
      <button class="btn btn-outline btn-sm" onclick="markAllRead()">Mark all read</button>
    </div>
    <div class="notif-list" id="notif-list">
      <div class="empty">
        <div class="e-icon">📭</div>
        <p>No notifications</p>
      </div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo-icon">🎓</div>
      <div class="logo-text">
        <h2>PlacementPro</h2>
        <span>Student Portal</span>
      </div>
    </div>

    <div class="nav-group">
      <div class="nav-group-label">Main</div>
      <div class="nav-item active" onclick="go('home')" id="nav-home">
        <span class="nav-icon">🏠</span> Home
      </div>
      <div class="nav-item" onclick="go('feed')" id="nav-feed">
        <span class="nav-icon">📡</span> Drive Feed
        <span class="nav-badge" id="feed-badge" style="display:none;">0</span>
      </div>
      <div class="nav-item" onclick="go('tracker')" id="nav-tracker">
        <span class="nav-icon">📊</span> My Applications
      </div>
      <div class="nav-item" onclick="go('assessments')" id="nav-assessments">
        <span class="nav-icon">📝</span> Assessments
        <span class="nav-badge" id="assess-badge" style="display:none;">0</span>
      </div>
      <div class="nav-item" onclick="go('resume-wizard')" id="nav-resume-wizard">
        <span class="nav-icon">✨</span> Resume Wizard
      </div>
      <div class="nav-item" onclick="go('courses')" id="nav-courses">
        <span class="nav-icon">🎓</span> Skill Courses
      </div>
    </div>

    <div class="nav-group">
      <div class="nav-group-label">Account</div>
      <div class="nav-item" onclick="window.location.href='/alumni-connect'" id="nav-alumni">
        <span class="nav-icon">🤝</span> Alumni Connect
      </div>
      <div class="nav-item" onclick="go('profile')" id="nav-profile">
        <span class="nav-icon">👤</span> My Profile
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="avatar" id="sb-avatar">?</div>
      <div class="user-info">
        <div class="name" id="sb-name">Loading…</div>
        <div class="role" id="sb-usn">—</div>
      </div>
      <button class="logout-btn" onclick="logout()" title="Logout">⇤</button>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="topbar-left">
        <h1 id="page-title">Home</h1>
        <p id="page-sub">Your placement journey</p>
      </div>
      <div class="topbar-right">
        <button class="notif-btn" onclick="toggleNotifPanel()" id="notif-btn">
          🔔
          <span class="notif-dot" id="notif-dot" style="display:none;"></span>
        </button>
        <button class="btn btn-outline btn-sm" onclick="refreshCurrent()">↻ Refresh</button>
      </div>
    </div>

    <!-- ══════ PAGE: HOME ══════ -->
    <div class="page active" id="page-home">

      <!-- Welcome Banner -->
      <div class="welcome-banner" id="welcome-banner">
        <div class="wb-left">
          <div class="wb-greeting" id="wb-greeting">Welcome back! 👋</div>
          <div class="wb-sub" id="wb-sub">Loading your profile…</div>
        </div>
        <div class="wb-cgpa">
          <div class="cgpa-val" id="wb-cgpa">—</div>
          <div class="cgpa-lbl">Current CGPA</div>
        </div>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="accent-line" style="background:var(--grad)"></div>
          <div class="sc-icon">📡</div>
          <div class="sc-value" id="h-eligible">—</div>
          <div class="sc-label">Eligible Drives</div>
          <div class="sc-sub">for you right now</div>
        </div>
        <div class="stat-card">
          <div class="accent-line" style="background:linear-gradient(135deg,#4f8ef7,#8b5cf6)"></div>
          <div class="sc-icon">📋</div>
          <div class="sc-value" id="h-applied">—</div>
          <div class="sc-label">Applied</div>
          <div class="sc-sub">applications sent</div>
        </div>
        <div class="stat-card">
          <div class="accent-line" style="background:linear-gradient(135deg,#f59e0b,#00d4aa)"></div>
          <div class="sc-icon">⭐</div>
          <div class="sc-value" id="h-shortlisted">—</div>
          <div class="sc-label">Shortlisted</div>
          <div class="sc-sub">companies selected you</div>
        </div>
        <div class="stat-card">
          <div class="accent-line" style="background:linear-gradient(135deg,#22c55e,#00d4aa)"></div>
          <div class="sc-icon">🏆</div>
          <div class="sc-value" id="h-selected">—</div>
          <div class="sc-label">Selected</div>
          <div class="sc-sub">offers received</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1.4fr 1fr;gap:20px;">
        <!-- Recent Drive Activity -->
        <div class="card" style="margin-bottom:0;">
          <div class="card-header">
            <div>
              <div class="card-title">Recent Drive Activity</div>
              <div class="card-sub">Latest updates from companies</div>
            </div>
            <button class="btn btn-outline btn-sm" onclick="go('feed')">View All →</button>
          </div>
          <div id="home-recent-drives"></div>
        </div>

        <!-- Quick Stats / Snapshot -->
        <div class="card" style="margin-bottom:0;">
          <div class="card-header">
            <div>
              <div class="card-title">Profile Snapshot</div>
              <div class="card-sub">Your academic overview</div>
            </div>
          </div>
          <div id="home-profile-snapshot"></div>
        </div>
      </div>

    </div>

    <!-- ══════ PAGE: DRIVE FEED ══════ -->
    <div class="page" id="page-feed">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
        <div>
          <div style="font-size:15px;font-weight:700;">📡 Personalised Drive Feed</div>
          <div style="font-size:12px;color:var(--text2);margin-top:3px;">Only companies you're eligible for — no clutter
          </div>
        </div>
        <div style="display:flex;gap:8px;">
          <select class="field" style="width:auto;padding:7px 12px;font-size:12px;" id="feed-filter"
            onchange="renderFeed()">
            <option value="">All Status</option>
            <option value="active">🟢 Active</option>
            <option value="upcoming">🔵 Upcoming</option>
          </select>
        </div>
      </div>
      <div class="drive-feed" id="drive-feed-list">
        <div class="empty">
          <div class="e-icon">⏳</div>
          <p>Loading eligible drives…</p>
        </div>
      </div>
    </div>

    <!-- ══════ PAGE: APPLICATION TRACKER ══════ -->
    <div class="page" id="page-tracker">
      <div style="margin-bottom:20px;">
        <div style="font-size:15px;font-weight:700;margin-bottom:4px;">📊 My Applications</div>
        <div style="font-size:12px;color:var(--text2);">Track your placement journey across all companies</div>
      </div>

      <!-- Filter tabs -->
      <div style="display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;">
        <button class="btn btn-primary btn-sm" onclick="filterTracker('')" id="tf-all">All</button>
        <button class="btn btn-outline btn-sm" onclick="filterTracker('eligible')" id="tf-eligible">Eligible</button>
        <button class="btn btn-outline btn-sm" onclick="filterTracker('applied')" id="tf-applied">Applied</button>
        <button class="btn btn-outline btn-sm" onclick="filterTracker('shortlisted')"
          id="tf-shortlisted">Shortlisted</button>
        <button class="btn btn-outline btn-sm" onclick="filterTracker('selected')" id="tf-selected">Selected</button>
        <button class="btn btn-outline btn-sm" onclick="filterTracker('rejected')" id="tf-rejected">Rejected</button>
      </div>

      <div id="tracker-list">
        <div class="empty">
          <div class="e-icon">⏳</div>
          <p>Loading applications…</p>
        </div>
      </div>
    </div>

    <!-- ══════ PAGE: ASSESSMENTS ══════ -->
    <div class="page" id="page-assessments">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
        <div>
          <div style="font-size:15px;font-weight:700;">📝 Assessments</div>
          <div style="font-size:12px;color:var(--text2);margin-top:3px;">Aptitude, technical and coding tests assigned
            to you</div>
        </div>
      </div>
      <div id="assessments-list-student">
        <div class="empty">
          <div class="e-icon">⏳</div>
          <p>Loading assessments…</p>
        </div>
      </div>
    </div>

    <!-- ══════ PAGE: QUIZ (FULL SCREEN) ══════ -->
    <div class="page" id="page-quiz">
      <div class="quiz-wrap" id="quiz-wrap">
        <div class="empty">
          <div class="e-icon">📝</div>
          <p>No assessment loaded</p>
        </div>
      </div>
    </div>

    <!-- ══════ PAGE: PROFILE ══════ -->
    <div class="page" id="page-profile">
      <div class="profile-hero">
        <div class="profile-avatar" id="prof-avatar">?</div>
        <div class="profile-name" id="prof-name">—</div>
        <div class="profile-usn" id="prof-usn">—</div>
        <div class="profile-chips" id="prof-chips"></div>
      </div>

      <div class="profile-grid">
        <div class="profile-section">
          <h3>Academic Details</h3>
          <div id="prof-academic"></div>
        </div>
        <div class="profile-section">
          <h3>Contact Information</h3>
          <div id="prof-contact"></div>
        </div>
        <div class="profile-section">
          <h3>Previous Education</h3>
          <div id="prof-prev-edu"></div>
        </div>
        <div class="profile-section">
          <h3>Assessment Performance</h3>
          <div id="prof-assessments"></div>
        </div>
      </div>
    </div>

    <!-- COURSES PAGE -->
    <div class="page" id="page-courses">
      <style>
        /* ═══════ COURSES PAGE ═══════ */
        .courses-filters {
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
          margin-bottom: 28px;
        }

        .cf-btn {
          padding: 7px 18px;
          border-radius: 20px;
          border: 1px solid var(--border);
          background: var(--surface2);
          color: var(--text2);
          font-family: inherit;
          font-size: 12px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.18s;
          letter-spacing: 0.3px;
        }

        .cf-btn:hover {
          border-color: var(--accent);
          color: var(--accent);
        }

        .cf-btn.active {
          background: var(--accent);
          border-color: var(--accent);
          color: #fff;
          box-shadow: 0 3px 14px rgba(79, 142, 247, 0.3);
        }

        .cf-btn.resume-filter.active {
          background: linear-gradient(135deg, #f59e0b, #ef4444);
          border-color: #f59e0b;
          color: #fff;
          box-shadow: 0 3px 14px rgba(245, 158, 11, 0.3);
        }

        .courses-skill-group {
          margin-bottom: 36px;
        }

        .courses-skill-title {
          font-size: 11px;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1.4px;
          color: var(--text3);
          margin-bottom: 14px;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .courses-skill-title::after {
          content: '';
          flex: 1;
          height: 1px;
          background: var(--border);
        }

        .courses-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
          gap: 18px;
        }

        .course-card {
          background: var(--surface);
          border: 1px solid var(--border);
          border-radius: 14px;
          overflow: hidden;
          transition: transform 0.18s, box-shadow 0.18s, border-color 0.18s;
          position: relative;
          cursor: pointer;
          text-decoration: none;
          display: block;
          color: inherit;
        }

        .course-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 16px 48px rgba(0, 0, 0, 0.35);
          border-color: var(--accent);
        }

        .course-card.resume-booster {
          border-color: rgba(245, 158, 11, 0.3);
        }

        .course-card.resume-booster:hover {
          border-color: #f59e0b;
          box-shadow: 0 16px 48px rgba(245, 158, 11, 0.15);
        }

        .course-thumb {
          position: relative;
          width: 100%;
          aspect-ratio: 16/9;
          background: #0d1424;
          overflow: hidden;
        }

        .course-thumb img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s;
        }

        .course-card:hover .course-thumb img {
          transform: scale(1.04);
        }

        .course-thumb-overlay {
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(0, 0, 0, 0.3);
          opacity: 0;
          transition: opacity 0.2s;
        }

        .course-card:hover .course-thumb-overlay {
          opacity: 1;
        }

        .play-btn {
          width: 48px;
          height: 48px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.92);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 18px;
        }

        .resume-badge-ribbon {
          position: absolute;
          top: 10px;
          right: -2px;
          background: linear-gradient(135deg, #f59e0b, #ef4444);
          color: #fff;
          font-size: 10px;
          font-weight: 800;
          padding: 4px 10px 4px 8px;
          border-radius: 4px 0 0 4px;
          letter-spacing: 0.4px;
          box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
          display: flex;
          align-items: center;
          gap: 4px;
        }

        .course-info {
          padding: 14px 15px 16px;
        }

        .course-skill-tag {
          font-size: 10px;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.8px;
          color: var(--accent2);
          margin-bottom: 6px;
        }

        .course-title {
          font-size: 13.5px;
          font-weight: 700;
          line-height: 1.45;
          color: var(--text);
          margin-bottom: 8px;
        }

        .course-meta {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 11px;
          color: var(--text3);
        }

        .course-meta .dot {
          width: 3px;
          height: 3px;
          border-radius: 50%;
          background: var(--text3);
        }

        .course-yt-label {
          display: flex;
          align-items: center;
          gap: 4px;
          color: #ff4444;
          font-size: 10.5px;
          font-weight: 700;
        }

        .courses-search-bar {
          position: relative;
          margin-bottom: 22px;
        }

        .courses-search-bar input {
          width: 100%;
          padding: 11px 16px 11px 42px;
          background: var(--surface2);
          border: 1px solid var(--border);
          border-radius: 12px;
          color: var(--text);
          font-family: inherit;
          font-size: 13.5px;
          transition: border-color 0.2s;
        }

        .courses-search-bar input:focus {
          outline: none;
          border-color: var(--accent);
        }

        .courses-search-bar .search-icon {
          position: absolute;
          left: 14px;
          top: 50%;
          transform: translateY(-50%);
          font-size: 16px;
          pointer-events: none;
        }

        .courses-empty {
          text-align: center;
          padding: 60px 20px;
          color: var(--text3);
          font-size: 14px;
        }

        .courses-stats-bar {
          display: flex;
          gap: 20px;
          margin-bottom: 26px;
          flex-wrap: wrap;
        }

        .cs-stat {
          background: var(--surface);
          border: 1px solid var(--border);
          border-radius: 12px;
          padding: 12px 18px;
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .cs-stat-val {
          font-size: 22px;
          font-weight: 800;
        }

        .cs-stat-lbl {
          font-size: 11px;
          color: var(--text2);
        }
      </style>

      <!-- Stats bar -->
      <div class="courses-stats-bar">
        <div class="cs-stat">
          <div style="font-size:22px;">📚</div>
          <div>
            <div class="cs-stat-val">25</div>
            <div class="cs-stat-lbl">Total Courses</div>
          </div>
        </div>
        <div class="cs-stat">
          <div style="font-size:22px;">🔥</div>
          <div>
            <div class="cs-stat-val" style="color:var(--warning);">10</div>
            <div class="cs-stat-lbl">Resume Boosters</div>
          </div>
        </div>
        <div class="cs-stat">
          <div style="font-size:22px;">🎯</div>
          <div>
            <div class="cs-stat-val" style="color:var(--accent2);">9</div>
            <div class="cs-stat-lbl">Skill Areas</div>
          </div>
        </div>
      </div>

      <!-- Search -->
      <div class="courses-search-bar">
        <span class="search-icon">🔍</span>
        <input type="text" id="courses-search" placeholder="Search courses, skills, topics…" oninput="filterCourses()">
      </div>

      <!-- Filters -->
      <div class="courses-filters" id="courses-filters">
        <button class="cf-btn active" onclick="setCourseFilter('all', this)">All Courses</button>
        <button class="cf-btn resume-filter" onclick="setCourseFilter('resume', this)">🔥 Resume Boosters</button>
        <button class="cf-btn" onclick="setCourseFilter('Programming Basics', this)">Programming Basics</button>
        <button class="cf-btn" onclick="setCourseFilter('DSA', this)">DSA</button>
        <button class="cf-btn" onclick="setCourseFilter('OOP Concepts', this)">OOP</button>
        <button class="cf-btn" onclick="setCourseFilter('DBMS Basics', this)">DBMS</button>
        <button class="cf-btn" onclick="setCourseFilter('Operating Systems', this)">OS</button>
        <button class="cf-btn" onclick="setCourseFilter('Computer Networks', this)">CN</button>
        <button class="cf-btn" onclick="setCourseFilter('Git & GitHub', this)">Git</button>
        <button class="cf-btn" onclick="setCourseFilter('Basic Web Dev', this)">Web Dev</button>
        <button class="cf-btn" onclick="setCourseFilter('System Design', this)">System Design</button>
      </div>

      <!-- Course listing -->
      <div id="courses-listing"></div>
    </div>

    <!-- RESUME WIZARD PAGE -->
    <div class="page" id="page-resume-wizard">
      <!-- STEP PROGRESS -->
      <div class="rw-step-progress" id="rw-step-progress">
        <div class="rw-step active" data-step="1">
          <div class="rw-step-circle">1</div>
          <div class="rw-step-label">Personal</div>
        </div>
        <div class="rw-step-line"></div>
        <div class="rw-step" data-step="2">
          <div class="rw-step-circle">2</div>
          <div class="rw-step-label">Education</div>
        </div>
        <div class="rw-step-line"></div>
        <div class="rw-step" data-step="3">
          <div class="rw-step-circle">3</div>
          <div class="rw-step-label">Skills &amp; Projects</div>
        </div>
        <div class="rw-step-line"></div>
        <div class="rw-step" data-step="4">
          <div class="rw-step-circle">4</div>
          <div class="rw-step-label">Experience</div>
        </div>
        <div class="rw-step-line"></div>
        <div class="rw-step" data-step="5">
          <div class="rw-step-circle">5</div>
          <div class="rw-step-label">Template</div>
        </div>
        <div class="rw-step-line"></div>
        <div class="rw-step" data-step="6">
          <div class="rw-step-circle">📊</div>
          <div class="rw-step-label">Dashboard</div>
        </div>
        <div class="rw-step-line"></div>
        <div class="rw-step" data-step="7">
          <div class="rw-step-circle">7</div>
          <div class="rw-step-label">Generate</div>
        </div>
      </div>

      <!-- STEP 1: PERSONAL -->
      <div class="rw-panel active" id="rw-step-1">
        <div class="rw-panel-header">
          <h2>👤 Personal Information</h2>
          <p>Let's start with the basics</p>
        </div>
        <div class="rw-form-grid">
          <div class="rw-field"><label>Full Name *</label><input type="text" id="rw-name" placeholder="Rahul Sharma"
              class="rw-input"></div>
          <div class="rw-field"><label>Email Address *</label><input type="email" id="rw-email"
              placeholder="rahul@college.edu" class="rw-input"></div>
          <div class="rw-field"><label>Phone Number</label><input type="text" id="rw-phone"
              placeholder="+91 98765 43210" class="rw-input"></div>
          <div class="rw-field"><label>LinkedIn Profile</label><input type="text" id="rw-linkedin"
              placeholder="linkedin.com/in/rahulsharma" class="rw-input"></div>
          <div class="rw-field"><label>GitHub Profile</label><input type="text" id="rw-github"
              placeholder="github.com/rahulsharma" class="rw-input"></div>
          <div class="rw-field"><label>Target Role / Headline</label><input type="text" id="rw-objective-role"
              placeholder="Passionate CSE Student" class="rw-input"></div>
          <div class="rw-field rw-full"><label>Summary / About Me</label><textarea id="rw-summary" rows="3"
              placeholder="I am a CSE student passionate about AI/ML..." class="rw-input"></textarea></div>
        </div>
        <div class="rw-actions">
          <div></div><button class="btn btn-primary" onclick="rwNext(2)">Next: Education →</button>
        </div>
      </div>

      <!-- STEP 2: EDUCATION -->
      <div class="rw-panel" id="rw-step-2">
        <div class="rw-panel-header">
          <h2>🎓 Education</h2>
          <p>Your academic background</p>
        </div>
        <div class="rw-form-grid">
          <div class="rw-field rw-full"><label>College / University *</label><input type="text" id="rw-college"
              placeholder="Vidyavardhaka College of Engineering" class="rw-input"></div>
          <div class="rw-field rw-full"><label>Degree &amp; Branch *</label><input type="text" id="rw-degree"
              placeholder="B.E in CSE-AIML" class="rw-input"></div>
          <div class="rw-field"><label>Current Semester</label><input type="text" id="rw-sem" placeholder="5"
              class="rw-input"></div>
          <div class="rw-field"><label>CGPA *</label><input type="number" id="rw-cgpa" step="0.01" min="0" max="10"
              placeholder="8.63" class="rw-input"></div>
          <div class="rw-field"><label>Year of Study / Graduation</label><input type="text" id="rw-year"
              placeholder="2022 – 2026" class="rw-input"></div>
          <div class="rw-field"><label>City / Location</label><input type="text" id="rw-city" placeholder="Mangalore"
              class="rw-input"></div>
          <div class="rw-field"><label>12th School Name</label><input type="text" id="rw-puc-school"
              placeholder="Vivekanandha PUC" class="rw-input"></div>
          <div class="rw-field"><label>12th Stream</label><input type="text" id="rw-puc-stream" placeholder="PCMB"
              class="rw-input"></div>
          <div class="rw-field"><label>12th Percentage *</label><input type="text" id="rw-twelfth" placeholder="91.5"
              class="rw-input"></div>
          <div class="rw-field"><label>10th School Name</label><input type="text" id="rw-school"
              placeholder="Vivekanandha EM School" class="rw-input"></div>
          <div class="rw-field"><label>10th Percentage *</label><input type="text" id="rw-tenth" placeholder="87.04"
              class="rw-input"></div>
        </div>
        <div class="rw-actions">
          <button class="btn btn-outline" onclick="rwNext(1)">← Back</button>
          <button class="btn btn-primary" onclick="rwNext(3)">Next: Skills →</button>
        </div>
      </div>

      <!-- STEP 3: SKILLS & PROJECTS -->
      <div class="rw-panel" id="rw-step-3">
        <div class="rw-panel-header">
          <h2>💻 Skills &amp; Projects</h2>
          <p>Showcase what you can do</p>
        </div>
        <div class="rw-sub">
          <h3>Technical Skills</h3>
          <div class="rw-form-grid">
            <div class="rw-field"><label>Languages</label><input type="text" id="rw-langs"
                placeholder="Python, Java, C++, JavaScript" class="rw-input"></div>
            <div class="rw-field"><label>Frameworks &amp; Libraries</label><input type="text" id="rw-frameworks"
                placeholder="React, Node.js, Flask" class="rw-input"></div>
            <div class="rw-field"><label>Tools &amp; Platforms</label><input type="text" id="rw-tools"
                placeholder="Git, Docker, AWS, Linux" class="rw-input"></div>
            <div class="rw-field"><label>Databases</label><input type="text" id="rw-dbs" placeholder="MySQL, MongoDB"
                class="rw-input"></div>
          </div>
        </div>
        <div class="rw-sub">
          <h3>Languages Known</h3>
          <input type="text" id="rw-languages-known" placeholder="English, Kannada, Hindi" class="rw-input"
            style="margin-bottom:12px;">
        </div>
        <div class="rw-sub">
          <h3>Interests / Hobbies</h3>
          <input type="text" id="rw-interests" placeholder="NCC, Karate, Drawing, Chess" class="rw-input"
            style="margin-bottom:12px;">
        </div>
        <div class="rw-sub">
          <h3>Completed Projects (for sidebar template)</h3>
          <input type="text" id="rw-completed-projects" placeholder="NCC Website, Bus Tracking, Digital Verification"
            class="rw-input" style="margin-bottom:12px;">
        </div>
        <div class="rw-sub">
          <h3>Active / Ongoing Projects</h3>
          <div id="rw-projects-container">
            <div class="rw-card" data-index="0">
              <div class="rw-card-row"><span class="rw-card-label">Project 1</span><button class="rw-remove-btn"
                  onclick="rwRemoveProject(this)">✕</button></div>
              <div class="rw-form-grid">
                <div class="rw-field"><label>Project Title</label><input type="text" placeholder="Posture Detection AI"
                    class="rw-input rw-proj-title"></div>
                <div class="rw-field"><label>Tech Stack</label><input type="text" placeholder="Python, OpenCV"
                    class="rw-input rw-proj-tech"></div>
                <div class="rw-field"><label>Status</label><select class="rw-input rw-proj-status">
                    <option value="done">Completed</option>
                    <option value="ongoing">Currently Working</option>
                  </select></div>
                <div class="rw-field"><label>GitHub/Live Link</label><input type="text"
                    placeholder="github.com/you/project" class="rw-input rw-proj-link"></div>
                <div class="rw-field rw-full"><label>Description (one point per line)</label><textarea rows="3"
                    placeholder="Detects posture of workers&#10;Gives real-time feedback"
                    class="rw-input rw-proj-desc"></textarea></div>
              </div>
            </div>
          </div>
          <button class="btn btn-outline" style="margin-top:8px;font-size:13px;padding:8px 16px;"
            onclick="rwAddProject()">+ Add Project</button>
        </div>
        <div class="rw-sub">
          <h3>Achievements &amp; Certifications</h3>
          <textarea id="rw-achievements" rows="4"
            placeholder="Winner of state level model competition (TECK SPARK 2025)&#10;Google Arcade Legend Rank"
            class="rw-input"></textarea>
        </div>
        <div class="rw-actions">
          <button class="btn btn-outline" onclick="rwNext(2)">← Back</button>
          <button class="btn btn-primary" onclick="rwNext(4)">Next: Experience →</button>
        </div>
      </div>

      <!-- STEP 4: INTERNSHIPS -->
      <div class="rw-panel" id="rw-step-4">
        <div class="rw-panel-header">
          <h2>💼 Internships &amp; Experience</h2>
          <p>Work experience (skip if none)</p>
        </div>
        <div id="rw-internships-container">
          <div class="rw-card" data-index="0">
            <div class="rw-card-row"><span class="rw-card-label">Internship 1</span><button class="rw-remove-btn"
                onclick="rwRemoveInternship(this)">✕</button></div>
            <div class="rw-form-grid">
              <div class="rw-field"><label>Role / Position</label><input type="text"
                  placeholder="Software Development Intern" class="rw-input rw-int-role"></div>
              <div class="rw-field"><label>Company</label><input type="text" placeholder="Amazon"
                  class="rw-input rw-int-company"></div>
              <div class="rw-field"><label>Duration</label><input type="text" placeholder="May 2024 – Jul 2024"
                  class="rw-input rw-int-duration"></div>
              <div class="rw-field rw-full"><label>What you did (one point per line)</label><textarea rows="3"
                  placeholder="Built REST APIs handling 10k requests/day" class="rw-input rw-int-desc"></textarea></div>
            </div>
          </div>
        </div>
        <button class="btn btn-outline" style="margin-top:8px;font-size:13px;padding:8px 16px;"
          onclick="rwAddInternship()">+ Add Internship</button>
        <div class="rw-actions">
          <button class="btn btn-outline" onclick="rwNext(3)">← Back</button>
          <button class="btn btn-primary" onclick="rwNext(5)">Next: Template →</button>
        </div>
      </div>

      <!-- STEP 5: TEMPLATE -->
      <div class="rw-panel" id="rw-step-5">
        <div class="rw-panel-header">
          <h2>🎨 Choose Your Resume Template</h2>
          <p>All are professional and ATS-friendly</p>
        </div>
        <div class="rw-template-grid">
          <div class="rw-template-card selected" data-template="classic" onclick="rwSelectTemplate('classic')">
            <div class="rw-template-preview rw-preview-classic">
              <div class="rtp-name">JOHN DOE</div>
              <div class="rtp-role">Passionate CSE Student</div>
              <div class="rtp-contact">Mangalore | <a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                  data-cfemail="bcd6d3d4d2fcd9d1ddd5d092dfd3d1">[email&#160;protected]</a></div>
              <div class="rtp-hr"></div>
              <div class="rtp-section">SUMMARY</div>
              <div class="rtp-text">Passionate CSE-AIML student...</div>
              <div class="rtp-section">EDUCATION</div>
              <div class="rtp-bold">VVC Engineering College</div>
              <div class="rtp-text">B.E CSE-AIML | CGPA: 8.63</div>
              <div class="rtp-section">PROJECTS</div>
              <div class="rtp-text">• Posture Detection AI</div>
            </div>
            <div class="rw-tpl-info">
              <div class="rw-tpl-name">✅ Classic</div>
              <div class="rw-tpl-desc">Clean black &amp; white. Traditional and ATS-friendly.</div>
            </div>
          </div>
          <div class="rw-template-card" data-template="modern" onclick="rwSelectTemplate('modern')">
            <div class="rw-template-preview rw-preview-modern">
              <div class="rtp-modern-head">
                <div class="rtp-college">NATIONAL INSTITUTE OF TECHNOLOGY</div>
                <div class="rtp-name-mod">JOHN DOE</div>
                <div class="rtp-role-mod">Software Development Engineer</div>
              </div>
              <div class="rtp-mod-section">EDUCATION</div>
              <div class="rtp-hr2"></div>
              <div class="rtp-bold">VVC Engineering | CGPA: 8.63</div>
              <div class="rtp-mod-section">PROJECTS</div>
              <div class="rtp-hr2"></div>
              <div class="rtp-text">Posture Detection AI | Python</div>
            </div>
            <div class="rw-tpl-info">
              <div class="rw-tpl-name">🔵 Modern Blue</div>
              <div class="rw-tpl-desc">College-branded blue header. Great for campus placements.</div>
            </div>
          </div>
          <div class="rw-template-card" data-template="sidebar" onclick="rwSelectTemplate('sidebar')">
            <div class="rw-template-preview rw-preview-sidebar">
              <div class="rtp-sidebar-left">
                <div class="rtp-sb-head">CONTACT</div>
                <div class="rtp-sb-item">+91 98765 43210</div>
                <div class="rtp-sb-head">SKILLS</div>
                <div class="rtp-sb-item">• Python</div>
                <div class="rtp-sb-item">• Java</div>
                <div class="rtp-sb-head">LANGUAGES</div>
                <div class="rtp-sb-item">• English</div>
              </div>
              <div class="rtp-sidebar-right">
                <div class="rtp-sb-topbar">JOHN DOE</div>
                <div class="rtp-sb-sub">CSE Student</div>
                <div class="rtp-sb-section">Education</div>
                <div class="rtp-sb-line"></div>
                <div class="rtp-bold" style="font-size:7px;margin-top:2px;">VVC Engineering | CGPA: 8.63</div>
              </div>
            </div>
            <div class="rw-tpl-info">
              <div class="rw-tpl-name">🌙 Dark Sidebar</div>
              <div class="rw-tpl-desc">Dark navy sidebar with cyan accents. Perfect for standing out.</div>
            </div>
          </div>
        </div>
        <div class="rw-selected-notice">Selected: <strong id="rw-selected-name">Classic</strong></div>
        <div class="rw-actions">
          <button class="btn btn-outline" onclick="rwNext(4)">← Back</button>
          <button class="btn btn-primary" onclick="rwGoToDashboard()">Next: View My Dashboard 📊 →</button>
        </div>
      </div>

      <!-- STEP 6: CAREER INTELLIGENCE DASHBOARD -->
      <div class="rw-panel" id="rw-step-6">
        <div class="rw-panel-header">
          <h2>📊 Career Intelligence Dashboard</h2>
          <p>Your profile score, skill gaps, course recommendations &amp; market insights</p>
        </div>
        <div class="rw-dashboard-setup">
          <label style="font-weight:600;font-size:0.9rem;color:var(--accent);">🎯 What role are you targeting?</label>
          <div style="display:flex;gap:12px;margin-top:10px;flex-wrap:wrap;align-items:center;">
            <select id="rw-target-role" class="rw-input" style="max-width:260px;">
              <option value="">Select a role...</option>
              <option>Software Developer</option>
              <option>Data Analyst</option>
              <option>Full Stack Developer</option>
              <option>ML Engineer</option>
              <option>Cloud Engineer</option>
              <option>DevOps Engineer</option>
            </select>
            <button class="btn btn-primary" onclick="rwLoadDashboard()">🔍 Analyze My Profile</button>
          </div>
        </div>
        <div id="rw-dash-loading" class="rw-loading hidden">
          <div class="rw-spinner"></div>
          <p>Analyzing your profile against market data...</p>
        </div>
        <div id="rw-dash-content" class="hidden">

          <!-- SCORE SECTION -->
          <div class="rw-dash-section">
            <div class="rw-dash-title">🏆 Profile Score</div>
            <div class="rw-score-card">
              <div class="rw-gauge-area">
                <div class="rw-gauge-wrap">
                  <svg class="rw-score-svg" viewBox="0 0 120 120">
                    <circle cx="60" cy="60" r="48" fill="none" stroke="var(--surface3)" stroke-width="12" />
                    <circle id="rw-score-ring" cx="60" cy="60" r="48" fill="none" stroke="var(--accent)"
                      stroke-width="12" stroke-dasharray="301.6" stroke-dashoffset="301.6" stroke-linecap="round"
                      transform="rotate(-90 60 60)" style="transition:stroke-dashoffset 1.5s ease" />
                    <text x="60" y="56" text-anchor="middle" font-family="DM Sans" font-weight="800" font-size="26"
                      fill="var(--text)" id="rw-score-text">0</text>
                    <text x="60" y="72" text-anchor="middle" font-family="DM Sans" font-size="10" fill="var(--text2)"
                      id="rw-score-label">Calculating</text>
                  </svg>
                  <div class="rw-grade-badge" id="rw-score-grade">--</div>
                </div>
              </div>
              <div class="rw-breakdown-area">
                <div class="rw-breakdown-title">Score Breakdown (out of 100)</div>
                <div id="rw-score-bars"></div>
                <div class="rw-score-tip" id="rw-score-tip"></div>
              </div>
            </div>
          </div>

          <!-- MARKET INTEL -->
          <div id="rw-market-section" class="rw-dash-section hidden">
            <div class="rw-dash-title">🔬 Market Intelligence</div>
            <div class="rw-market-card">
              <div class="rw-market-stats" id="rw-market-stats"></div>
              <div class="rw-market-banner" id="rw-market-banner"></div>
              <div class="rw-skill-gap-title">Skills demanded by placed <span id="rw-market-role"></span>s</div>
              <div class="rw-skill-gap-grid" id="rw-skill-gap-grid"></div>
            </div>
          </div>

          <!-- LEARNING PATH -->
          <div class="rw-dash-section">
            <div class="rw-dash-title">🗺️ Your 3-Month Learning Path</div>
            <div class="rw-path-card">
              <div class="rw-path-timeline" id="rw-path-timeline"></div>
            </div>
          </div>

          <!-- COURSES -->
          <div class="rw-dash-section">
            <div class="rw-dash-title">📚 Resume Booster Courses</div>
            <div id="rw-courses-note"></div>
            <div class="rw-courses-grid" id="rw-courses-grid"></div>
          </div>
        </div>
        <div class="rw-actions">
          <button class="btn btn-outline" onclick="rwNext(5)">← Back</button>
          <button class="btn btn-primary" onclick="rwNext(7)">Next: Generate &amp; Compare →</button>
        </div>
      </div>

      <!-- STEP 7: GENERATE & COMPARE -->
      <div class="rw-panel" id="rw-step-7">
        <div class="rw-panel-header">
          <h2>🚀 Generate Your Resume</h2>
          <p>Download your professional college-branded resume as a PDF</p>
        </div>

        <!-- TEMPLATE REMINDER -->
        <div class="rw-action-card">
          <div class="rw-action-icon">🎨</div>
          <div class="rw-action-content">
            <h3>Selected Template: <span id="rw-chosen-template">Classic</span></h3>
            <p style="color:var(--text2);font-size:13px;margin-top:4px;">Your resume will be generated with all the
              details you filled in the previous steps.</p>
          </div>
        </div>

        <!-- GENERATE BUTTON -->
        <div style="text-align:center;margin:28px 0 16px;">
          <button class="btn btn-primary" id="rw-gen-btn" onclick="rwGeneratePDF()"
            style="font-size:16px;padding:14px 40px;border-radius:14px;">
            ⬇ Download Resume as PDF
          </button>
        </div>
        <div id="rw-gen-error" class="hidden"
          style="background:rgba(244,63,94,0.1);border:1px solid rgba(244,63,94,0.3);border-radius:10px;padding:12px 16px;font-size:13px;color:var(--danger);margin-bottom:16px;text-align:center;">
        </div>

        <!-- TIPS -->
        <div
          style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px 20px;margin-top:8px;">
          <div style="font-size:13px;font-weight:600;color:var(--text);margin-bottom:10px;">💡 Tips for a strong resume
          </div>
          <ul style="list-style:none;padding:0;display:flex;flex-direction:column;gap:7px;">
            <li style="font-size:12px;color:var(--text2);">✅ Make sure your CGPA, 10th & 12th marks are filled in Step 2
            </li>
            <li style="font-size:12px;color:var(--text2);">✅ Add at least 2 projects with descriptions for a stronger
              resume</li>
            <li style="font-size:12px;color:var(--text2);">✅ Include your LinkedIn & GitHub links for recruiter
              visibility</li>
            <li style="font-size:12px;color:var(--text2);">✅ List skills separated by commas — e.g. Python, Java, React
            </li>
          </ul>
        </div>

        <div class="rw-actions" style="margin-top:28px;">
          <button class="btn btn-outline" onclick="rwNext(6)">← Back</button>
          <button class="btn btn-primary" onclick="go('feed')">View Eligible Drives →</button>
        </div>
      </div>

    </div>
    <!-- END RESUME WIZARD PAGE -->

  </div><!-- /main -->

  <!-- APPLY CONFIRM MODAL -->
  <div class="overlay" id="apply-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Apply for Drive</div>
        <button class="modal-close" onclick="closeOverlay('apply-overlay')">✕</button>
      </div>
      <div id="apply-modal-body"></div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeOverlay('apply-overlay')">Cancel</button>
        <button class="btn btn-primary" onclick="confirmApply()">✓ Confirm Application</button>
      </div>
    </div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
  <script>
    // ═══════════════════════════════════════════════════════════
    // GLOBALS
    // ═══════════════════════════════════════════════════════════
    let currentUser = null;
    let studentData = null;
    let allDrives = [];
    let myApplications = [];
    let allAssessments = [];
    let currentQuiz = null;
    let quizTimerInterval = null;
    let quizAnswers = {};
    let pendingApplyDriveId = null;
    let currentPage = 'home';
    let trackerFilter = '';

    // ═══════════════════════════════════════════════════════════
    // API HELPER
    // ═══════════════════════════════════════════════════════════
    async function api(method, url, body) {
      try {
        const opts = { method, headers: { 'Content-Type': 'application/json' } };
        if (body) opts.body = JSON.stringify(body);
        const r = await fetch(url, opts);
        return r.json();
      } catch (e) { return { error: e.message }; }
    }

    // ═══════════════════════════════════════════════════════════
    // TOAST
    // ═══════════════════════════════════════════════════════════
    function toast(title, msg = '', type = '') {
      const w = document.getElementById('toast-wrap');
      const t = document.createElement('div');
      t.className = `toast ${type}`;
      t.innerHTML = `<div class="toast-t">${title}</div>${msg ? `<div class="toast-m">${msg}</div>` : ''}`;
      w.appendChild(t);
      setTimeout(() => t.remove(), 4000);
    }

    // ═══════════════════════════════════════════════════════════
    // NAVIGATION
    // ═══════════════════════════════════════════════════════════
    const pageTitles = {
      home: ['Home', 'Your placement journey at a glance'],
      feed: ['Drive Feed', 'Companies you\'re eligible for'],
      tracker: ['My Applications', 'Track your placement progress'],
      assessments: ['Assessments', 'Tests & evaluations'],
      quiz: ['Take Assessment', 'Complete your test'],
      profile: ['My Profile', 'Your academic profile'],
      'resume-wizard': ['Resume Wizard', 'Build your resume & get AI insights'],
      'courses': ['Skill Courses', 'Learn, grow & boost your placement readiness']
    };

    function go(page) {
      currentPage = page;
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      const el = document.getElementById(`page-${page}`);
      const nav = document.getElementById(`nav-${page}`);
      if (el) el.classList.add('active');
      if (nav) nav.classList.add('active');
      const [title, sub] = pageTitles[page] || [page, ''];
      document.getElementById('page-title').textContent = title;
      document.getElementById('page-sub').textContent = sub;
      if (page === 'home') loadHome();
      if (page === 'feed') loadFeed();
      if (page === 'tracker') loadTracker();
      if (page === 'assessments') loadAssessments();
      if (page === 'profile') loadProfile();
      if (page === 'resume-wizard') rwInit();
      if (page === 'courses') { setTimeout(renderCourses, 50); }
      // Close notif panel on nav
      document.getElementById('notif-panel').classList.remove('show');
    }

    function refreshCurrent() { go(currentPage); }

    // ═══════════════════════════════════════════════════════════
    // AUTH
    // ═══════════════════════════════════════════════════════════
    async function logout() {
      await api('POST', '/api/auth/logout');
      window.location.href = '/';
    }

    // ═══════════════════════════════════════════════════════════
    // HELPERS
    // ═══════════════════════════════════════════════════════════
    function fmtDate(d) {
      if (!d) return '—';
      return new Date(d).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
    }
    function timeAgo(d) {
      const diff = Date.now() - new Date(d).getTime();
      const m = Math.floor(diff / 60000);
      if (m < 60) return `${m}m ago`;
      const h = Math.floor(m / 60);
      if (h < 24) return `${h}h ago`;
      return `${Math.floor(h / 24)}d ago`;
    }
    function initials(name) {
      return name ? name.split(' ').slice(0, 2).map(w => w[0]).join('').toUpperCase() : '?';
    }
    function statusBadge(status) {
      const map = {
        eligible: ['b-gray', 'Eligible'],
        applied: ['b-blue', 'Applied'],
        shortlisted: ['b-yellow', '⭐ Shortlisted'],
        selected: ['b-green', '🏆 Selected'],
        rejected: ['b-red', 'Rejected']
      };
      const [cls, label] = map[status] || ['b-gray', status];
      return `<span class="badge ${cls}">${label}</span>`;
    }
    function notifIcon(type) {
      return { drive: '🏢', assessment: '📝', shortlist: '⭐', general: '📣' }[type] || '🔔';
    }
    function notifColor(type) {
      return { drive: 'rgba(79,142,247,0.1)', assessment: 'rgba(139,92,246,0.1)', shortlist: 'rgba(245,158,11,0.1)', general: 'rgba(0,212,170,0.1)' }[type] || 'var(--surface2)';
    }

    function showOverlay(id) { document.getElementById(id).classList.add('show'); }
    function closeOverlay(id) { document.getElementById(id).classList.remove('show'); }

    // ═══════════════════════════════════════════════════════════
    // HOME PAGE
    // ═══════════════════════════════════════════════════════════
    async function loadHome() {
      if (!studentData) return;
      const s = studentData;

      // Set welcome banner
      const hour = new Date().getHours();
      const greeting = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
      document.getElementById('wb-greeting').textContent = `${greeting}, ${s.name.split(' ')[0]}! 👋`;
      document.getElementById('wb-sub').textContent = `${s.branch} · Year ${s.year} · ${s.backlogs === 0 ? '0 backlogs' : `${s.backlogs} backlog(s)`}`;
      document.getElementById('wb-cgpa').textContent = s.cgpa.toFixed(2);

      // Count application stats
      const apps = s.driveApplications || [];
      document.getElementById('h-eligible').textContent = allDrives.length;
      document.getElementById('h-applied').textContent = apps.filter(a => a.status === 'applied').length;
      document.getElementById('h-shortlisted').textContent = apps.filter(a => a.status === 'shortlisted').length;
      document.getElementById('h-selected').textContent = apps.filter(a => a.status === 'selected').length;

      // Recent drives (top 3)
      const recent = allDrives.slice(0, 3);
      document.getElementById('home-recent-drives').innerHTML = recent.length ?
        recent.map(d => {
          const app = apps.find(a => a.driveId === d._id);
          const status = app ? app.status : 'eligible';
          return `<div style="display:flex;align-items:center;gap:12px;padding:11px 0;border-bottom:1px solid rgba(30,45,72,0.4);">
        <div style="width:36px;height:36px;border-radius:10px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;">🏢</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:700;margin-bottom:2px;">${d.companyName}</div>
          <div style="font-size:11px;color:var(--text3);">${d.package || 'Package TBD'} · ${fmtDate(d.driveDate)}</div>
        </div>
        ${statusBadge(status)}
      </div>`;
        }).join('') :
        '<div class="empty" style="padding:30px"><div class="e-icon">📡</div><p>No active drives</p></div>';

      // Profile snapshot
      document.getElementById('home-profile-snapshot').innerHTML = `
    <div class="profile-row"><span class="label">Branch</span><span class="value">${s.branch}</span></div>
    <div class="profile-row"><span class="label">Year</span><span class="value">Year ${s.year}</span></div>
    <div class="profile-row"><span class="label">CGPA</span><span class="value" style="color:${s.cgpa >= 8 ? 'var(--success)' : s.cgpa >= 6 ? 'var(--text)' : 'var(--danger)'}">${s.cgpa}</span></div>
    <div class="profile-row"><span class="label">Backlogs</span><span class="value" style="color:${s.backlogs === 0 ? 'var(--success)' : 'var(--danger)'}">${s.backlogs}</span></div>
    <div class="profile-row"><span class="label">Assessments Done</span><span class="value">${(s.assessmentScores || []).length}</span></div>
    <div class="profile-row"><span class="label">Applications</span><span class="value">${apps.length}</span></div>
  `;
    }

    // ═══════════════════════════════════════════════════════════
    // DRIVE FEED
    // ═══════════════════════════════════════════════════════════
    async function loadFeed() {
      const el = document.getElementById('drive-feed-list');
      el.innerHTML = '<div class="empty"><div class="e-icon">⏳</div><p>Loading…</p></div>';
      const drives = await api('GET', `/api/drives/student/${currentUser.username}`);
      allDrives = Array.isArray(drives) ? drives : [];
      // Update badge
      const badge = document.getElementById('feed-badge');
      if (allDrives.length > 0) { badge.style.display = ''; badge.textContent = allDrives.length; }
      else badge.style.display = 'none';
      renderFeed();
    }

    function renderFeed() {
      const filter = document.getElementById('feed-filter').value;
      const el = document.getElementById('drive-feed-list');
      const drives = filter ? allDrives.filter(d => d.status === filter) : allDrives;
      if (!drives.length) {
        el.innerHTML = `<div class="empty-fancy"><div class="ef-icon">🎯</div><h3>No drives found</h3><p>Check back later for new opportunities</p></div>`;
        return;
      }
      const apps = studentData?.driveApplications || [];
      el.innerHTML = drives.map(d => {
        const app = apps.find(a => a.driveId === d._id);
        const status = app ? app.status : 'eligible';
        const applied = ['applied', 'shortlisted', 'selected'].includes(status);
        const deadline = d.deadline ? new Date(d.deadline) : null;
        const isExpired = deadline && deadline < new Date();
        return `<div class="drive-card-s status-${d.status}">
      <div class="dc-header">
        <div class="dc-company">
          <div class="dc-company-icon">🏢</div>
          ${d.companyName}
        </div>
        <div style="display:flex;gap:7px;align-items:center;">
          <span class="badge ${d.status === 'active' ? 'b-green' : d.status === 'upcoming' ? 'b-blue' : 'b-gray'}">${d.status === 'active' ? '🟢 Active' : d.status === 'upcoming' ? '🔵 Upcoming' : '✓ Completed'}</span>
          ${statusBadge(status)}
        </div>
      </div>
      <div class="dc-meta">
        ${d.package ? `<span class="chip">💰 <strong>${d.package}</strong></span>` : ''}
        ${d.location ? `<span class="chip">📍 <strong>${d.location}</strong></span>` : ''}
        <span class="chip">📊 CGPA ≥ <strong>${d.minCGPA}</strong></span>
        <span class="chip">🚫 Max Backlogs: <strong>${d.maxBacklogs}</strong></span>
        ${d.driveDate ? `<span class="chip">📅 <strong>${fmtDate(d.driveDate)}</strong></span>` : ''}
        ${d.eligibleBranches?.length ? `<span class="chip">🎓 ${d.eligibleBranches.join(', ')}</span>` : '<span class="chip">🎓 All Branches</span>'}
      </div>
      ${d.description ? `<div class="dc-desc">${d.description}</div>` : ''}
      <div class="dc-footer">
        <div class="dc-deadline">
          Deadline: ${deadline ? `<strong ${isExpired ? 'style="color:var(--danger)"' : ''}>${fmtDate(d.deadline)}${isExpired ? ' (Expired)' : ''}</strong>` : '<strong>Open</strong>'}
        </div>
        <div class="dc-actions">
          ${!applied && !isExpired && d.status !== 'completed' ?
            `<button class="btn btn-primary btn-sm" onclick="openApply('${d._id}','${d.companyName}')">Apply Now →</button>` :
            applied ? `<button class="btn btn-outline btn-sm" disabled>✓ ${status.charAt(0).toUpperCase() + status.slice(1)}</button>` :
              `<button class="btn btn-outline btn-sm" disabled>Closed</button>`
          }
        </div>
      </div>
    </div>`;
      }).join('');
    }

    // ═══════════════════════════════════════════════════════════
    // APPLY
    // ═══════════════════════════════════════════════════════════
    function openApply(driveId, companyName) {
      pendingApplyDriveId = driveId;
      document.getElementById('apply-modal-body').innerHTML = `
    <div style="text-align:center;padding:14px 0 20px;">
      <div style="font-size:48px;margin-bottom:14px;">🏢</div>
      <div style="font-size:18px;font-weight:700;margin-bottom:6px;">${companyName}</div>
      <div style="font-size:13px;color:var(--text2);">You're confirming your interest to apply for this placement drive. Once applied, this cannot be undone.</div>
    </div>
    <div style="background:rgba(79,142,247,0.06);border:1px solid rgba(79,142,247,0.15);border-radius:10px;padding:14px 16px;font-size:13px;color:var(--text2);">
      ℹ️ Your profile (CGPA: <strong>${studentData.cgpa}</strong>, Branch: <strong>${studentData.branch}</strong>) meets the eligibility criteria.
    </div>`;
      showOverlay('apply-overlay');
    }

    async function confirmApply() {
      if (!pendingApplyDriveId || !studentData) return;
      // Update student driveApplications status to 'applied'
      const apps = studentData.driveApplications || [];
      const existing = apps.find(a => a.driveId === pendingApplyDriveId);
      if (existing) {
        existing.status = 'applied';
      } else {
        apps.push({ driveId: pendingApplyDriveId, status: 'applied' });
      }
      const res = await api('PUT', `/api/students/${studentData._id}`, { driveApplications: apps });
      if (res && res._id) {
        studentData = res;
        toast('Applied! ✓', 'Your application has been submitted', 's');
        closeOverlay('apply-overlay');
        renderFeed();
        loadTracker();
      } else {
        toast('Error', res?.error || 'Failed to apply', 'e');
      }
      pendingApplyDriveId = null;
    }

    // ═══════════════════════════════════════════════════════════
    // APPLICATION TRACKER
    // ═══════════════════════════════════════════════════════════
    async function loadTracker() {
      const el = document.getElementById('tracker-list');
      el.innerHTML = '<div class="empty"><div class="e-icon">⏳</div><p>Loading…</p></div>';
      if (!studentData) return;
      const apps = studentData.driveApplications || [];
      myApplications = apps;
      renderTracker();
    }

    function filterTracker(status) {
      trackerFilter = status;
      // Update tab styles
      document.querySelectorAll('[id^="tf-"]').forEach(b => {
        b.className = 'btn btn-outline btn-sm';
      });
      const active = document.getElementById(`tf-${status || 'all'}`);
      if (active) active.className = 'btn btn-primary btn-sm';
      renderTracker();
    }

    function renderTracker() {
      const el = document.getElementById('tracker-list');
      const apps = trackerFilter ? myApplications.filter(a => a.status === trackerFilter) : myApplications;
      if (!apps.length) {
        el.innerHTML = `<div class="empty-fancy"><div class="ef-icon">📋</div><h3>${trackerFilter ? 'No ' + trackerFilter + ' applications' : 'No applications yet'}</h3><p>${trackerFilter ? 'Try a different filter' : 'Apply to drives from the Feed page'}</p></div>`;
        return;
      }
      const STAGES = [
        { key: 'eligible', label: 'Eligible', icon: '✓' },
        { key: 'applied', label: 'Applied', icon: '📋' },
        { key: 'shortlisted', label: 'Shortlisted', icon: '⭐' },
        { key: 'selected', label: 'Selected', icon: '🏆' }
      ];
      const stageIdx = s => STAGES.findIndex(st => st.key === s);
      el.innerHTML = apps.map(app => {
        const drive = allDrives.find(d => d._id === app.driveId) || { companyName: 'Unknown Company', package: '', status: '' };
        const si = app.status === 'rejected' ? -1 : stageIdx(app.status);
        return `<div class="app-card">
      <div class="app-header">
        <div>
          <div class="app-company">${drive.companyName}</div>
          ${drive.package ? `<div style="font-size:11.5px;color:var(--text3);margin-top:2px;">💰 ${drive.package}</div>` : ''}
        </div>
        <div style="text-align:right;">
          ${statusBadge(app.status)}
          ${app.ranking ? `<div style="margin-top:5px;"><span class="badge ${app.ranking === 'Best' ? 'b-green' : app.ranking === 'Better' ? 'b-blue' : 'b-yellow'}">${app.ranking}</span></div>` : ''}
        </div>
      </div>
      ${app.status !== 'rejected' ? `
      <div class="status-pipeline">
        ${STAGES.map((st, i) => {
          const isDone = si > i;
          const isActive = si === i;
          return `<div class="pipe-step ${isDone ? 'done' : ''} ${isActive ? 'active-step' : ''}">
            <div class="pipe-dot">${isDone ? '✓' : st.icon}</div>
            <div class="pipe-label">${st.label}</div>
          </div>`;
        }).join('')}
      </div>` : `
      <div style="padding:10px 0;display:flex;align-items:center;gap:8px;color:var(--danger);font-size:13px;">
        ⛔ Application was not shortlisted for this drive. Keep applying!
      </div>`}
    </div>`;
      }).join('');
    }

    // ═══════════════════════════════════════════════════════════
    // ASSESSMENTS
    // ═══════════════════════════════════════════════════════════
    async function loadAssessments() {
      const el = document.getElementById('assessments-list-student');
      el.innerHTML = '<div class="empty"><div class="e-icon">⏳</div><p>Loading assessments…</p></div>';
      const data = await api('GET', '/api/assessments');
      allAssessments = Array.isArray(data) ? data.filter(a => a.isActive) : [];
      const badge = document.getElementById('assess-badge');
      const taken = studentData?.assessmentScores || [];
      const pending = allAssessments.filter(a => !taken.find(t => t.assessmentId === a._id));
      if (pending.length > 0) { badge.style.display = ''; badge.textContent = pending.length; }
      else badge.style.display = 'none';
      if (!allAssessments.length) {
        el.innerHTML = `<div class="empty-fancy"><div class="ef-icon">📝</div><h3>No Assessments Available</h3><p>The TPO will publish tests when drives are active</p></div>`;
        return;
      }
      el.innerHTML = allAssessments.map(a => {
        const done = taken.find(t => t.assessmentId === a._id || t.assessmentId?.toString() === a._id);
        const pct = done && done.maxScore > 0 ? Math.round((done.score / done.maxScore) * 100) : null;
        const color = pct === null ? 'var(--text3)' : pct >= 70 ? 'var(--success)' : pct >= 40 ? 'var(--warning)' : 'var(--danger)';
        return `<div class="assess-card">
      <div class="assess-header">
        <div>
          <div class="assess-title">${a.title}</div>
        </div>
        ${done ? `<span class="badge b-green">✓ Completed</span>` : `<span class="badge b-blue">Pending</span>`}
      </div>
      <div class="assess-meta">
        <span class="badge b-purple">${a.type}</span>
        <span class="badge b-gray">${a.questions?.length || 0} questions</span>
        <span class="badge b-cyan">⏱ ${a.timeLimit} min</span>
        <span class="badge b-yellow">${a.totalMarks} marks</span>
      </div>
      ${done ? `
        <div class="assess-result">
          <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;">
            <span style="color:var(--text2);">Your score: <strong style="color:${color}">${done.score} / ${done.maxScore}</strong></span>
            <strong style="color:${color};">${pct}%</strong>
          </div>
          <div class="result-bar" style="margin-top:8px;">
            <div class="result-fill" style="width:${pct}%;background:${pct >= 70 ? 'var(--grad)' : pct >= 40 ? 'linear-gradient(135deg,#f59e0b,#f43f5e)' : 'var(--danger)'}"></div>
          </div>
        </div>` : `
        <div style="margin-top:4px;">
          <button class="btn btn-primary btn-sm" onclick="startQuiz('${a._id}')">▶ Start Assessment</button>
        </div>`}
    </div>`;
      }).join('');
    }

    // ═══════════════════════════════════════════════════════════
    // QUIZ ENGINE
    // ═══════════════════════════════════════════════════════════
    async function startQuiz(id) {
      const el = document.getElementById('quiz-wrap');
      el.innerHTML = '<div class="empty"><div class="e-icon"><div class="loader"></div></div><p>Loading assessment…</p></div>';
      go('quiz');
      const data = await api('GET', `/api/assessments/${id}/take`);
      if (!data || data.error) { el.innerHTML = `<div class="empty"><div class="e-icon">❌</div><p>${data?.error || 'Failed to load'}</p></div>`; return; }
      currentQuiz = { ...data, id, started: Date.now() };
      quizAnswers = {};
      renderQuiz();
    }

    function renderQuiz() {
      const q = currentQuiz;
      const el = document.getElementById('quiz-wrap');
      const LETTERS = ['A', 'B', 'C', 'D'];
      el.innerHTML = `
    <div class="quiz-header">
      <div class="quiz-timer" id="quiz-timer">⏱ ${String(Math.floor(q.timeLimit)).padStart(2, '0')}:00</div>
      <div style="font-size:16px;font-weight:700;margin-bottom:4px;">${q.title}</div>
      <div style="font-size:12px;color:var(--text2);">${q.type} · ${q.questions.length} questions · ${q.totalMarks} marks</div>
      <div class="quiz-progress" style="margin-top:14px;">
        <div class="quiz-progress-fill" id="quiz-prog" style="width:0%"></div>
      </div>
    </div>
    <div id="quiz-questions">
      ${q.questions.map((qu, qi) => `
        <div class="q-card" id="qc-${qi}">
          <div class="q-num">Question ${qi + 1} of ${q.questions.length} · ${qu.marks} mark${qu.marks > 1 ? 's' : ''}</div>
          <div class="q-text">${qu.question}</div>
          <div class="q-options">
            ${qu.options.map((opt, oi) => `
              <div class="q-opt" id="qo-${qi}-${oi}" onclick="selectOpt(${qi},${oi})">
                <div class="q-opt-letter">${LETTERS[oi]}</div>
                ${opt}
              </div>`).join('')}
          </div>
        </div>`).join('')}
    </div>
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:8px;padding-bottom:32px;">
      <button class="btn btn-outline" onclick="go('assessments')">← Back</button>
      <button class="btn btn-primary" onclick="submitQuiz()">Submit Assessment ✓</button>
    </div>`;

      // Timer
      let remaining = q.timeLimit * 60;
      if (quizTimerInterval) clearInterval(quizTimerInterval);
      quizTimerInterval = setInterval(() => {
        remaining--;
        const m = Math.floor(remaining / 60);
        const s = remaining % 60;
        const timerEl = document.getElementById('quiz-timer');
        if (timerEl) {
          timerEl.textContent = `⏱ ${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
          if (remaining <= 60) timerEl.classList.add('warn');
        }
        if (remaining <= 0) { clearInterval(quizTimerInterval); submitQuiz(); }
      }, 1000);
    }

    function selectOpt(qi, oi) {
      // Clear previous selection for this question
      const prev = quizAnswers[qi];
      if (prev !== undefined) document.getElementById(`qo-${qi}-${prev}`)?.classList.remove('selected');
      quizAnswers[qi] = oi;
      document.getElementById(`qo-${qi}-${oi}`)?.classList.add('selected');
      // Update progress
      const answered = Object.keys(quizAnswers).length;
      const pct = Math.round((answered / currentQuiz.questions.length) * 100);
      const prog = document.getElementById('quiz-prog');
      if (prog) prog.style.width = pct + '%';
    }

    async function submitQuiz() {
      if (quizTimerInterval) { clearInterval(quizTimerInterval); quizTimerInterval = null; }
      const unanswered = currentQuiz.questions.length - Object.keys(quizAnswers).length;
      if (unanswered > 0 && !confirm(`You have ${unanswered} unanswered question(s). Submit anyway?`)) return;
      const res = await api('POST', `/api/assessments/${currentQuiz.id}/submit`, {
        usn: currentUser.username,
        answers: quizAnswers
      });
      if (res.error) { toast('Error', res.error, 'e'); return; }
      showQuizResult(res);
      // Refresh student data
      const fresh = await api('GET', `/api/students/me/${currentUser.username}`);
      if (fresh && fresh._id) studentData = fresh;
    }

    function showQuizResult(res) {
      const pct = res.percentage;
      const pass = pct >= 50;
      const el = document.getElementById('quiz-wrap');
      el.innerHTML = `
    <div class="quiz-result">
      <div class="result-circle ${!pass ? 'fail' : ''}">${pct}%</div>
      <div style="font-size:22px;font-weight:800;margin-bottom:8px;">${pass ? '🎉 Well Done!' : '📚 Keep Practicing!'}</div>
      <div style="font-size:14px;color:var(--text2);margin-bottom:24px;">
        You scored <strong>${res.score}</strong> out of <strong>${res.maxScore}</strong> marks
      </div>
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px;max-width:340px;margin:0 auto 24px;text-align:left;">
        <div class="profile-row"><span class="label">Score</span><span class="value">${res.score} / ${res.maxScore}</span></div>
        <div class="profile-row"><span class="label">Percentage</span><span class="value" style="color:${pct >= 70 ? 'var(--success)' : pct >= 40 ? 'var(--warning)' : 'var(--danger)'}">${pct}%</span></div>
        <div class="profile-row"><span class="label">Status</span><span class="value" style="color:${pass ? 'var(--success)' : 'var(--danger)'}">${pass ? 'Pass' : 'Needs Improvement'}</span></div>
      </div>
      <div style="display:flex;gap:12px;justify-content:center;">
        <button class="btn btn-outline" onclick="go('assessments')">← Back to Assessments</button>
        <button class="btn btn-primary" onclick="go('home')">Go to Home</button>
      </div>
    </div>`;
    }

    // ═══════════════════════════════════════════════════════════
    // PROFILE
    // ═══════════════════════════════════════════════════════════
    async function loadProfile() {
      if (!studentData) return;
      const s = studentData;
      const ini = initials(s.name);
      document.getElementById('prof-avatar').textContent = ini;
      document.getElementById('sb-avatar').textContent = ini;
      document.getElementById('prof-name').textContent = s.name;
      document.getElementById('prof-usn').textContent = s.usn;
      document.getElementById('prof-chips').innerHTML = `
    <span class="badge b-blue">${s.branch}</span>
    <span class="badge b-purple">Year ${s.year}</span>
    <span class="badge ${s.cgpa >= 8 ? 'b-green' : s.cgpa >= 6 ? 'b-blue' : 'b-red'}">${s.cgpa} CGPA</span>
    <span class="badge ${s.backlogs === 0 ? 'b-green' : 'b-red'}">${s.backlogs} Backlog${s.backlogs !== 1 ? 's' : ''}</span>`;
      document.getElementById('prof-academic').innerHTML = `
    <div class="profile-row"><span class="label">Branch</span><span class="value">${s.branch}</span></div>
    <div class="profile-row"><span class="label">Year</span><span class="value">Year ${s.year}</span></div>
    <div class="profile-row"><span class="label">CGPA</span><span class="value" style="color:${s.cgpa >= 8 ? 'var(--success)' : 'var(--text)'}">${s.cgpa}</span></div>
    <div class="profile-row"><span class="label">Backlogs</span><span class="value" style="color:${s.backlogs === 0 ? 'var(--success)' : 'var(--danger)'}">${s.backlogs}</span></div>`;
      document.getElementById('prof-contact').innerHTML = `
    <div class="profile-row"><span class="label">Email</span><span class="value" style="font-size:12px;">${s.email || '—'}</span></div>
    <div class="profile-row"><span class="label">Phone</span><span class="value">${s.phone || '—'}</span></div>
    <div class="profile-row"><span class="label">Personal Email</span><span class="value" style="font-size:12px;">${s.profile?.personalEmail || '—'}</span></div>
    <div class="profile-row"><span class="label">Gender</span><span class="value">${s.profile?.gender || '—'}</span></div>`;
      const p = s.profile || {};
      document.getElementById('prof-prev-edu').innerHTML = `
    <div class="profile-row"><span class="label">10th Marks</span><span class="value">${p.marks10th || '—'}${p.marks10th ? '%' : ''}</span></div>
    <div class="profile-row"><span class="label">10th Board</span><span class="value">${p.board10th || '—'}</span></div>
    <div class="profile-row"><span class="label">12th Marks</span><span class="value">${p.marks12th || '—'}${p.marks12th ? '%' : ''}</span></div>
    <div class="profile-row"><span class="label">12th Board</span><span class="value">${p.board12th || '—'}</span></div>
    ${p.diplomaPct ? `<div class="profile-row"><span class="label">Diploma</span><span class="value">${p.diplomaPct}%</span></div>` : ''}`;
      const scores = s.assessmentScores || [];
      document.getElementById('prof-assessments').innerHTML = scores.length ?
        scores.map(sc => {
          const pct = sc.maxScore > 0 ? Math.round((sc.score / sc.maxScore) * 100) : 0;
          const color = pct >= 70 ? 'var(--success)' : pct >= 40 ? 'var(--warning)' : 'var(--danger)';
          return `<div style="margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;font-size:12.5px;margin-bottom:4px;">
          <span style="color:var(--text2);font-weight:500;">Assessment</span>
          <strong style="color:${color}">${sc.score}/${sc.maxScore} (${pct}%)</strong>
        </div>
        <div class="result-bar"><div class="result-fill" style="width:${pct}%;background:${pct >= 70 ? 'var(--grad)' : pct >= 40 ? 'linear-gradient(135deg,#f59e0b,#f43f5e)' : 'var(--danger)'}"></div></div>
      </div>`;
        }).join('') :
        '<div style="color:var(--text3);font-size:13px;padding:8px 0;">No assessments taken yet</div>';
    }

    // ═══════════════════════════════════════════════════════════
    // NOTIFICATIONS
    // ═══════════════════════════════════════════════════════════
    async function loadNotifications() {
      const data = await api('GET', `/api/notifications/${currentUser.username}`);
      const notifs = Array.isArray(data) ? data : [];
      const unread = notifs.filter(n => !n.isRead).length;
      const dot = document.getElementById('notif-dot');
      const badge = document.getElementById('notif-btn');
      if (unread > 0) dot.style.display = ''; else dot.style.display = 'none';
      const list = document.getElementById('notif-list');
      list.innerHTML = notifs.length ?
        notifs.map(n => `<div class="notif-item ${!n.isRead ? 'unread' : ''}" onclick="readNotif('${n._id}')">
      <div class="notif-icon" style="background:${notifColor(n.type)}">${notifIcon(n.type)}</div>
      <div class="notif-body" style="flex:1;">
        <div class="notif-title">${n.title}</div>
        <div class="notif-msg">${n.message}</div>
        <div class="notif-time">${timeAgo(n.createdAt)}</div>
      </div>
      ${!n.isRead ? '<div class="notif-unread-dot"></div>' : ''}
    </div>`).join('') :
        '<div class="empty" style="padding:32px"><div class="e-icon">📭</div><p>All caught up!</p></div>';
    }

    async function readNotif(id) {
      await api('PUT', `/api/notifications/${id}/read`);
      loadNotifications();
    }

    async function markAllRead() {
      await api('PUT', `/api/notifications/markall/${currentUser.username}`);
      toast('All read', 'Notifications cleared', 's');
      loadNotifications();
    }

    function toggleNotifPanel() {
      const p = document.getElementById('notif-panel');
      const show = p.classList.toggle('show');
      if (show) loadNotifications();
    }

    // Close notif panel when clicking outside
    document.addEventListener('click', e => {
      const panel = document.getElementById('notif-panel');
      const btn = document.getElementById('notif-btn');
      if (!panel.contains(e.target) && !btn.contains(e.target)) {
        panel.classList.remove('show');
      }
    });

    // ═══════════════════════════════════════════════════════════
    // INIT
    // ═══════════════════════════════════════════════════════════
    (async () => {
      const me = await api('GET', '/api/auth/me');
      if (!me || me.error || me.role !== 'student') {
        window.location.href = '/';
        return;
      }
      currentUser = me;
      document.getElementById('sb-name').textContent = me.name || me.username;
      document.getElementById('sb-usn').textContent = me.username;
      document.getElementById('sb-avatar').textContent = initials(me.name || me.username);

      // Load student data
      const s = await api('GET', `/api/students/me/${me.username}`);
      if (s && s._id) {
        studentData = s;
        document.getElementById('sb-avatar').textContent = initials(s.name);
      } else {
        // Fallback for test/demo login with no DB record
        studentData = {
          _id: null, name: me.name || 'Test Student', usn: me.username,
          branch: 'CSE', year: 4, cgpa: 8.5, backlogs: 0,
          email: 'test@example.com', phone: '', profile: {},
          driveApplications: [], assessmentScores: []
        };
      }

      // Load eligible drives
      const drives = await api('GET', `/api/drives/student/${me.username}`);
      allDrives = Array.isArray(drives) ? drives : [];

      // Initial notification check
      loadNotifications();

      // Load home
      loadHome();

      // Periodic notification check
      setInterval(loadNotifications, 30000);

      // ═══════════════════════════════════════════════════════════
      // RESUME WIZARD
      // ═══════════════════════════════════════════════════════════
      let rwCurrentStep = 1;
      let rwSelectedTemplate = 'classic';
      let rwProjCount = 1;
      let rwInternCount = 1;
      let rwInitialized = false;

      const rwTemplateNames = { classic: 'Classic (Black & White)', modern: 'Modern Blue', sidebar: 'Dark Sidebar' };

      const RW_MARKET = {
        'Data Analyst': { skills: { Python: 92, SQL: 88, PowerBI: 80, Excel: 75, Tableau: 65, 'Machine Learning': 45 }, avg_cgpa: 7.2, avg_package: '12 LPA', placed_count: 1200 },
        'Software Developer': { skills: { DSA: 95, Java: 75, Python: 72, 'System Design': 68, Git: 85, SQL: 60, React: 55 }, avg_cgpa: 7.5, avg_package: '20 LPA', placed_count: 4500 },
        'Full Stack Developer': { skills: { React: 88, 'Node.js': 82, SQL: 78, Python: 65, DSA: 70, AWS: 55, Docker: 50 }, avg_cgpa: 7.3, avg_package: '18 LPA', placed_count: 2100 },
        'ML Engineer': { skills: { Python: 98, 'Machine Learning': 95, 'Deep Learning': 82, SQL: 70, Cloud: 65, DSA: 75 }, avg_cgpa: 7.8, avg_package: '22 LPA', placed_count: 800 },
        'Cloud Engineer': { skills: { AWS: 85, Docker: 78, Kubernetes: 65, Python: 70, Linux: 72, Terraform: 55 }, avg_cgpa: 7.0, avg_package: '20 LPA', placed_count: 650 },
        'DevOps Engineer': { skills: { Docker: 88, 'CI/CD': 85, Kubernetes: 72, Python: 68, AWS: 78, Linux: 80, Git: 90 }, avg_cgpa: 7.0, avg_package: '18 LPA', placed_count: 500 },
      };

      const RW_COURSES = {
        DSA: [{ platform: 'Udemy', title: 'Master the Coding Interview: Data Structures + Algorithms', rating: '4.7', duration: '19.5 hrs', url: 'https://www.udemy.com/course/master-the-coding-interview-data-structures-algorithms/' }],
        'System Design': [{ platform: 'Udemy', title: 'Grokking the System Design Interview', rating: '4.6', duration: '12 hrs', url: 'https://www.udemy.com/course/system-design-interview-prep/' }],
        'Machine Learning': [{ platform: 'Coursera', title: 'Machine Learning Specialization – Andrew Ng', rating: '4.9', duration: '3 months', url: 'https://www.coursera.org/specializations/machine-learning-introduction' }],
        Python: [{ platform: 'Udemy', title: '100 Days of Code – Python Pro Bootcamp', rating: '4.7', duration: '65 hrs', url: 'https://www.udemy.com/course/100-days-of-code/' }],
        React: [{ platform: 'Udemy', title: 'React – The Complete Guide 2024', rating: '4.7', duration: '69 hrs', url: 'https://www.udemy.com/course/react-the-complete-guide-incl-redux/' }],
        SQL: [{ platform: 'Udemy', title: 'The Complete SQL Bootcamp: Go from Zero to Hero', rating: '4.7', duration: '9 hrs', url: 'https://www.udemy.com/course/the-complete-sql-bootcamp/' }],
        AWS: [{ platform: 'Coursera', title: 'AWS Cloud Practitioner Essentials', rating: '4.6', duration: '2 months', url: 'https://www.coursera.org/learn/aws-cloud-practitioner-essentials' }],
        Docker: [{ platform: 'Udemy', title: 'Docker & Kubernetes: The Practical Guide', rating: '4.7', duration: '22 hrs', url: 'https://www.udemy.com/course/docker-kubernetes-the-practical-guide/' }],
        Java: [{ platform: 'Udemy', title: 'Java Masterclass 2024 – Tim Buchalka', rating: '4.7', duration: '100+ hrs', url: 'https://www.udemy.com/course/java-the-complete-java-developer-course/' }],
        PowerBI: [{ platform: 'Udemy', title: 'Microsoft Power BI – Up & Running', rating: '4.6', duration: '18 hrs', url: 'https://www.udemy.com/course/mspowerbi/' }],
      };

      function rwInit() {
        if (!rwInitialized && studentData) {
          // Pre-fill from student data
          const s = studentData;
          const setVal = (id, v) => { const el = document.getElementById(id); if (el && v) el.value = v; };
          setVal('rw-name', s.name);
          setVal('rw-email', s.email || s.personalEmail || s.collegeEmail || '');
          setVal('rw-phone', s.phone || '');
          setVal('rw-college', s.college || '');
          setVal('rw-degree', s.degree || (s.branch ? `B.E in ${s.branch}` : ''));
          setVal('rw-cgpa', s.cgpa || '');
          setVal('rw-twelfth', s.twelfthMarks || s.puc || '');
          setVal('rw-tenth', s.tenthMarks || s.tenth || '');
          setVal('rw-sem', s.sem || '');
          rwInitialized = true;
        }
      }

      function rwNext(n) {
        document.getElementById(`rw-step-${rwCurrentStep}`).classList.remove('active');
        document.querySelectorAll('.rw-step').forEach((el, i) => {
          el.classList.remove('active', 'done');
          if (i + 1 < n) el.classList.add('done');
        });
        rwCurrentStep = n;
        document.getElementById(`rw-step-${n}`).classList.add('active');
        const stepEl = document.querySelector(`.rw-step[data-step="${n}"]`);
        if (stepEl) stepEl.classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
        if (n === 7) document.getElementById('rw-chosen-template').textContent = rwTemplateNames[rwSelectedTemplate];
      }

      function rwGoToDashboard() {
        rwNext(6);
        const role = document.getElementById('rw-target-role').value;
        if (role) rwLoadDashboard();
      }

      function rwSelectTemplate(t) {
        rwSelectedTemplate = t;
        document.querySelectorAll('.rw-template-card').forEach(c => c.classList.toggle('selected', c.dataset.template === t));
        document.getElementById('rw-selected-name').textContent = rwTemplateNames[t];
      }

      function rwAddProject() {
        const c = document.getElementById('rw-projects-container');
        rwProjCount++;
        const d = document.createElement('div');
        d.className = 'rw-card';
        d.innerHTML = `<div class="rw-card-row"><span class="rw-card-label">Project ${rwProjCount}</span><button class="rw-remove-btn" onclick="rwRemoveProject(this)">✕</button></div>
          <div class="rw-form-grid">
            <div class="rw-field"><label>Project Title</label><input type="text" class="rw-input rw-proj-title" placeholder="My Project"></div>
            <div class="rw-field"><label>Tech Stack</label><input type="text" class="rw-input rw-proj-tech" placeholder="Python, React"></div>
            <div class="rw-field"><label>Status</label><select class="rw-input rw-proj-status"><option value="done">Completed</option><option value="ongoing">Currently Working</option></select></div>
            <div class="rw-field"><label>GitHub/Live Link</label><input type="text" class="rw-input rw-proj-link" placeholder="github.com/you/project"></div>
            <div class="rw-field rw-full"><label>Description (one point per line)</label><textarea rows="3" class="rw-input rw-proj-desc"></textarea></div>
          </div>`;
        c.appendChild(d);
      }
      function rwRemoveProject(btn) { btn.closest('.rw-card').remove(); }

      function rwAddInternship() {
        const c = document.getElementById('rw-internships-container');
        rwInternCount++;
        const d = document.createElement('div');
        d.className = 'rw-card';
        d.innerHTML = `<div class="rw-card-row"><span class="rw-card-label">Internship ${rwInternCount}</span><button class="rw-remove-btn" onclick="rwRemoveInternship(this)">✕</button></div>
          <div class="rw-form-grid">
            <div class="rw-field"><label>Role</label><input type="text" class="rw-input rw-int-role" placeholder="Software Development Intern"></div>
            <div class="rw-field"><label>Company</label><input type="text" class="rw-input rw-int-company" placeholder="Amazon"></div>
            <div class="rw-field"><label>Duration</label><input type="text" class="rw-input rw-int-duration" placeholder="May 2024 – Jul 2024"></div>
            <div class="rw-field rw-full"><label>What you did</label><textarea rows="3" class="rw-input rw-int-desc"></textarea></div>
          </div>`;
        c.appendChild(d);
      }
      function rwRemoveInternship(btn) { btn.closest('.rw-card').remove(); }

      function rwCollectData() {
        const allSkills = [];
        ['rw-langs', 'rw-frameworks', 'rw-tools', 'rw-dbs'].forEach(id => {
          const v = document.getElementById(id)?.value.trim();
          if (v) v.split(',').map(s => s.trim()).filter(Boolean).forEach(s => allSkills.push(s));
        });
        const projects = [];
        document.querySelectorAll('#rw-projects-container .rw-card').forEach(card => {
          const t = card.querySelector('.rw-proj-title')?.value.trim();
          if (t) projects.push({ title: t, tech: card.querySelector('.rw-proj-tech')?.value.trim() || '', status: card.querySelector('.rw-proj-status')?.value || 'done', link: card.querySelector('.rw-proj-link')?.value.trim() || '', description: card.querySelector('.rw-proj-desc')?.value.trim() || '' });
        });
        const internships = [];
        document.querySelectorAll('#rw-internships-container .rw-card').forEach(card => {
          const c = card.querySelector('.rw-int-company')?.value.trim();
          if (c) internships.push({ role: card.querySelector('.rw-int-role')?.value.trim() || '', company: c, duration: card.querySelector('.rw-int-duration')?.value.trim() || '', description: card.querySelector('.rw-int-desc')?.value.trim() || '' });
        });
        const achievements = (document.getElementById('rw-achievements')?.value || '').split('\n').map(s => s.replace(/^[•\-]\s*/, '').trim()).filter(Boolean);
        return {
          name: document.getElementById('rw-name')?.value.trim() || '',
          email: document.getElementById('rw-email')?.value.trim() || '',
          phone: document.getElementById('rw-phone')?.value.trim() || '',
          linkedin: document.getElementById('rw-linkedin')?.value.trim() || '',
          github: document.getElementById('rw-github')?.value.trim() || '',
          objective_role: document.getElementById('rw-objective-role')?.value.trim() || '',
          summary: document.getElementById('rw-summary')?.value.trim() || '',
          education: {
            college: document.getElementById('rw-college')?.value.trim() || '',
            degree: document.getElementById('rw-degree')?.value.trim() || '',
            sem: document.getElementById('rw-sem')?.value.trim() || '',
            cgpa: document.getElementById('rw-cgpa')?.value.trim() || '',
            year: document.getElementById('rw-year')?.value.trim() || '',
            city: document.getElementById('rw-city')?.value.trim() || '',
            puc_school: document.getElementById('rw-puc-school')?.value.trim() || '',
            puc_stream: document.getElementById('rw-puc-stream')?.value.trim() || '',
            twelfth: document.getElementById('rw-twelfth')?.value.trim() || '',
            school: document.getElementById('rw-school')?.value.trim() || '',
            tenth: document.getElementById('rw-tenth')?.value.trim() || '',
          },
          skills: allSkills, projects, internships, achievements,
          template: rwSelectedTemplate
        };
      }

      function rwCalculateScore(data) {
        const edu = data.education;
        let cgpa = parseFloat(edu.cgpa) || 0;
        let twelfth = parseFloat(edu.twelfth) || 0;
        let tenth = parseFloat(edu.tenth) || 0;
        const cgpaScore = Math.min(40, Math.round(cgpa / 10 * 40 * 10) / 10);
        const twelfthScore = Math.min(25, Math.round(twelfth / 100 * 25 * 10) / 10);
        const tenthScore = Math.min(20, Math.round(tenth / 100 * 20 * 10) / 10);
        const bonus = Math.min(5, data.skills.length * 0.5) + Math.min(5, data.projects.length * 1.5) + Math.min(3, data.internships.length * 1.5) + Math.min(2, data.achievements.length * 0.5);
        const bonusScore = Math.min(15, Math.round(bonus * 10) / 10);
        const total = Math.min(100, Math.round((cgpaScore + twelfthScore + tenthScore + bonusScore) * 10) / 10);
        let grade, label;
        if (total >= 90) { grade = 'A+'; label = 'Exceptional'; }
        else if (total >= 80) { grade = 'A'; label = 'Strong'; }
        else if (total >= 70) { grade = 'B+'; label = 'Good'; }
        else if (total >= 60) { grade = 'B'; label = 'Average'; }
        else if (total >= 50) { grade = 'C'; label = 'Below Average'; }
        else { grade = 'D'; label = 'Needs Improvement'; }
        return { total, grade, label, breakdown: { 'CGPA': { raw: cgpa, max: 40, score: cgpaScore }, '12th Marks': { raw: twelfth, max: 25, score: twelfthScore }, '10th Marks': { raw: tenth, max: 20, score: tenthScore }, 'Bonus (Skills/Projects)': { raw: null, max: 15, score: bonusScore } } };
      }

      function rwGetCourses(score, targetRole, userSkills) {
        const skillsLower = userSkills.map(s => s.toLowerCase());
        const recs = [];
        if (targetRole && RW_MARKET[targetRole]) {
          const ms = RW_MARKET[targetRole].skills;
          Object.entries(ms).sort((a, b) => b[1] - a[1]).forEach(([skill, pct]) => {
            if (!skillsLower.includes(skill.toLowerCase()) && pct >= 60 && RW_COURSES[skill]) {
              RW_COURSES[skill].slice(0, 1).forEach(c => recs.push({ ...c, skill, market_pct: pct, reason: `${pct}% of placed ${targetRole}s have ${skill} — you don't` }));
            }
          });
        }
        ['DSA', 'Python'].forEach(s => {
          if (!skillsLower.includes(s.toLowerCase()) && RW_COURSES[s] && !recs.find(r => r.title === RW_COURSES[s][0].title)) {
            recs.push({ ...RW_COURSES[s][0], skill: s, market_pct: null, reason: `${s} is expected by most recruiters` });
          }
        });
        return recs.slice(0, 6);
      }

      function rwGetLearningPath(score, targetRole, userSkills) {
        const skillsLower = userSkills.map(s => s.toLowerCase());
        const m = RW_MARKET[targetRole] || RW_MARKET['Software Developer'];
        const missing = Object.entries(m.skills).sort((a, b) => b[1] - a[1]).filter(([s]) => !skillsLower.includes(s.toLowerCase())).map(([s]) => s);
        const m0 = missing[0] || 'DSA'; const m1 = missing[1] || 'System Design';
        if (score < 60) return [
          { week: 'Week 1–2', title: 'Academic Foundation', desc: 'Revise core subjects to improve CGPA; seek supplemental assignments from professors', status: 'current' },
          { week: 'Week 3–4', title: `Learn ${m0}`, desc: `Start beginner tutorials + solve 30 LeetCode Easy problems`, status: 'upcoming' },
          { week: 'Month 2', title: 'Build a Starter Project', desc: 'Apply skills in a small end-to-end project to populate your portfolio', status: 'upcoming' },
          { week: 'Month 3', title: 'Internship Hunt', desc: 'Apply on Internshala, LinkedIn, and company portals for off-campus internships', status: 'upcoming' },
        ];
        if (score < 80) return [
          { week: 'Week 1–2', title: `Strengthen ${m0}`, desc: 'Complete 50 LeetCode problems (Easy → Medium) and understand patterns', status: 'current' },
          { week: 'Week 3–4', title: `Learn ${m1}`, desc: 'Take a structured online course and implement two mini-projects', status: 'upcoming' },
          { week: 'Month 2', title: 'Portfolio Project', desc: `Build a full project using ${m0} + ${m1} with a proper README on GitHub`, status: 'upcoming' },
          { week: 'Month 3', title: 'Mock Interviews + Apply', desc: '10 mock interviews on Pramp/InterviewBit, apply to 20+ companies', status: 'upcoming' },
        ];
        return [
          { week: 'Week 1–2', title: 'Advanced DSA & System Design', desc: 'Solve 100 Medium-Hard LeetCode problems; study HLD/LLD design patterns', status: 'current' },
          { week: 'Week 3–4', title: `Master ${m0}`, desc: 'Get a certification or build a production-grade project to prove expertise', status: 'upcoming' },
          { week: 'Month 2', title: 'Open Source + FAANG Prep', desc: 'Contribute to 2 open-source repos; study company-specific prep on Glassdoor', status: 'upcoming' },
          { week: 'Month 3', title: 'Referrals + Dream Applications', desc: 'Apply via referral network; reach out to employees via LinkedIn cold-DM', status: 'upcoming' },
        ];
      }

      async function rwLoadDashboard() {
        const targetRole = document.getElementById('rw-target-role').value;
        if (!targetRole) { toast('Select a Role', 'Please select a target role first', 'e'); return; }
        const data = rwCollectData();
        document.getElementById('rw-dash-loading').classList.remove('hidden');
        document.getElementById('rw-dash-content').classList.add('hidden');
        // Small delay to show loader, then calculate locally
        await new Promise(r => setTimeout(r, 600));
        try {
          const score = rwCalculateScore(data);
          const courses = rwGetCourses(score.total, targetRole, data.skills);
          const learning_path = rwGetLearningPath(score.total, targetRole, data.skills);
          let market_intel = null;
          if (RW_MARKET[targetRole]) {
            const m = RW_MARKET[targetRole];
            const skillsLower = data.skills.map(s => s.toLowerCase());
            market_intel = { role: targetRole, avg_cgpa: m.avg_cgpa, avg_package: m.avg_package, placed_count: m.placed_count, skill_analysis: Object.entries(m.skills).sort((a, b) => b[1] - a[1]).map(([skill, pct]) => ({ skill, market_pct: pct, have: skillsLower.includes(skill.toLowerCase()) })) };
          }
          rwRenderDashboard({ score, courses, learning_path, market_intel });
          document.getElementById('rw-dash-content').classList.remove('hidden');
        } catch (e) { toast('Error', e.message, 'e'); }
        finally { document.getElementById('rw-dash-loading').classList.add('hidden'); }
      }

      function rwRenderDashboard({ score, courses, learning_path, market_intel }) {
        const total = score.total;
        const ring = document.getElementById('rw-score-ring');
        const circumference = 301.6;
        ring.style.strokeDashoffset = circumference;
        const color = total >= 80 ? '#22c55e' : total >= 60 ? '#f59e0b' : '#f43f5e';
        ring.style.stroke = color;
        setTimeout(() => { ring.style.strokeDashoffset = circumference - (total / 100) * circumference; }, 100);
        document.getElementById('rw-score-text').textContent = total;
        document.getElementById('rw-score-label').textContent = score.label;
        const gradeBadge = document.getElementById('rw-score-grade');
        gradeBadge.textContent = score.grade;
        gradeBadge.style.background = color;

        const barsEl = document.getElementById('rw-score-bars');
        barsEl.innerHTML = '';
        Object.entries(score.breakdown).forEach(([label, val]) => {
          const pct = Math.round((val.score / val.max) * 100);
          const raw = val.raw !== null ? ` (${val.raw}${label.includes('Marks') ? '%' : label.includes('CGPA') ? ' CGPA' : ''})` : '';
          const barColor = pct >= 75 ? '#22c55e' : pct >= 50 ? '#f59e0b' : '#f43f5e';
          barsEl.innerHTML += `<div class="rw-bar-row"><div class="rw-bar-lbl">${label}${raw}</div><div class="rw-bar-track"><div class="rw-bar-fill" style="background:${barColor}" data-width="${pct}%"></div></div><div class="rw-bar-score">${val.score}/${val.max}</div></div>`;
        });
        setTimeout(() => { document.querySelectorAll('.rw-bar-fill').forEach(el => el.style.width = el.dataset.width); }, 200);
        const tip = document.getElementById('rw-score-tip');
        if (total >= 80) tip.innerHTML = `✅ <strong>Strong profile!</strong> Focus on top companies and system design prep.`;
        else if (total >= 60) tip.innerHTML = `⚡ <strong>Good profile!</strong> Bridge skill gaps with the courses below.`;
        else tip.innerHTML = `📘 <strong>Needs improvement.</strong> Focus on academics first, then build strong projects.`;

        if (market_intel) {
          document.getElementById('rw-market-section').classList.remove('hidden');
          document.getElementById('rw-market-role').textContent = market_intel.role;
          document.getElementById('rw-market-stats').innerHTML = `
            <div class="rw-mstat"><div class="rw-mstat-num">${market_intel.avg_cgpa}</div><div class="rw-mstat-lbl">Avg CGPA of placed students</div></div>
            <div class="rw-mstat"><div class="rw-mstat-num">${market_intel.avg_package}</div><div class="rw-mstat-lbl">Average package offered</div></div>
            <div class="rw-mstat"><div class="rw-mstat-num">${market_intel.placed_count.toLocaleString()}+</div><div class="rw-mstat-lbl">Students placed last year</div></div>`;
          const missing = market_intel.skill_analysis.filter(s => !s.have && s.market_pct >= 60);
          if (missing.length > 0) {
            const top = missing[0];
            document.getElementById('rw-market-banner').innerHTML = `<span>💡</span><span>Targeting <strong>${market_intel.role}</strong>: <strong>${top.market_pct}%</strong> of placed students had <strong>${top.skill}</strong> — you don't. See the learning path below.</span>`;
          } else {
            document.getElementById('rw-market-banner').innerHTML = `<span>🌟</span><span>Your skills align well with <strong>${market_intel.role}</strong> requirements! Focus on depth and projects.</span>`;
          }
          document.getElementById('rw-skill-gap-grid').innerHTML = market_intel.skill_analysis.map(s => `
            <div class="rw-skill-row">
              <div class="rw-skill-name">${s.skill}</div>
              <div class="rw-skill-bar-wrap"><div class="rw-skill-bar" data-width="${s.market_pct}%" data-color="${s.have ? '#22c55e' : '#f43f5e'}"></div></div>
              <div class="rw-skill-pct">${s.market_pct}%</div>
              <div class="rw-skill-badge ${s.have ? 'have' : 'missing'}">${s.have ? '✓ You have it' : '✗ Missing'}</div>
            </div>`).join('');
          setTimeout(() => { document.querySelectorAll('.rw-skill-bar').forEach(el => { el.style.width = el.dataset.width; el.style.background = el.dataset.color; }); }, 300);
        } else {
          document.getElementById('rw-market-section').classList.add('hidden');
        }

        document.getElementById('rw-path-timeline').innerHTML = learning_path.map((step, i) => `
          <div class="rw-path-step">
            <div class="rw-path-node ${step.status}">${i + 1}</div>
            <div><div class="rw-path-week">${step.week}</div><div class="rw-path-title">${step.title}</div><div class="rw-path-desc">${step.desc}</div></div>
          </div>`).join('');

        const noteEl = document.getElementById('rw-courses-note');
        noteEl.innerHTML = total < 80 ? `<div class="rw-courses-alert">⚠️ Score: <strong>${total}/100</strong>. These courses will boost your resume and fill skill gaps.</div>` : `<div class="rw-courses-alert rw-courses-alert-green">✅ Strong profile! These courses will help you stand out even more.</div>`;

        const gridEl = document.getElementById('rw-courses-grid');
        if (!courses.length) { gridEl.innerHTML = `<p style="color:var(--text2);font-size:13px;">No specific courses needed — your profile matches market requirements well!</p>`; }
        else { gridEl.innerHTML = courses.map(c => `<a href="${c.url}" target="_blank" class="rw-course-card"><div class="rw-course-badge">${c.platform}</div><div class="rw-course-title">${c.title}</div><div class="rw-course-meta">⭐ ${c.rating} · ⏱ ${c.duration}${c.market_pct ? ` · 🔥 ${c.market_pct}% demand` : ''}</div><div class="rw-course-reason">${c.reason}</div><div class="rw-course-cta">View Course →</div></a>`).join(''); }
      }

      function rwGeneratePDF() {
        const data = rwCollectData();
        if (!data.name) { toast('Missing Info', 'Please fill your name in Step 1 first', 'e'); return; }

        const btn = document.getElementById('rw-gen-btn');
        const errEl = document.getElementById('rw-gen-error');
        btn.disabled = true;
        btn.textContent = '⏳ Generating PDF...';
        errEl.classList.add('hidden');

        try {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF({ unit: 'mm', format: 'a4' });
          const W = 210; const H = 297;
          const edu = data.education;
          const template = rwSelectedTemplate;

          // ── helpers ──
          const lh = (size) => size * 0.45; // line height in mm
          const wrap = (doc, text, x, maxW) => doc.splitTextToSize(text || '', maxW);

          if (template === 'modern') {
            // ── MODERN BLUE ──
            // Header block
            doc.setFillColor(26, 35, 126);
            doc.rect(0, 0, W, 38, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8); doc.setFont('helvetica', 'normal');
            doc.text('VIDYAVARDHAKA COLLEGE OF ENGINEERING', W / 2, 10, { align: 'center' });
            doc.setFontSize(20); doc.setFont('helvetica', 'bold');
            doc.text((data.name || '').toUpperCase(), W / 2, 20, { align: 'center' });
            doc.setFontSize(10); doc.setFont('helvetica', 'normal');
            doc.text(data.objective_role || '', W / 2, 27, { align: 'center' });
            const contacts = [data.email, data.phone, data.linkedin, data.github].filter(Boolean).join('  |  ');
            doc.setFontSize(7.5);
            doc.text(contacts, W / 2, 34, { align: 'center' });

            doc.setTextColor(0, 0, 0);
            let y = 46;
            const margin = 15;
            const contentW = W - margin * 2;

            const modernSection = (title) => {
              doc.setFontSize(10); doc.setFont('helvetica', 'bold');
              doc.setTextColor(26, 35, 126);
              doc.text(title, margin, y); y += 1.5;
              doc.setDrawColor(26, 35, 126); doc.setLineWidth(0.4);
              doc.line(margin, y, W - margin, y); y += 4;
              doc.setTextColor(0, 0, 0);
            };

            const checkPage = (needed = 8) => { if (y + needed > H - 12) { doc.addPage(); y = 15; } };

            // Summary
            if (data.summary) {
              modernSection('SUMMARY');
              doc.setFontSize(9); doc.setFont('helvetica', 'normal');
              const lines = wrap(doc, data.summary, margin, contentW);
              lines.forEach(l => { checkPage(); doc.text(l, margin, y); y += 5; });
              y += 2;
            }

            // Education
            modernSection('EDUCATION');
            doc.setFontSize(9.5); doc.setFont('helvetica', 'bold');
            doc.text(edu.college || '', margin, y);
            doc.setFont('helvetica', 'normal'); doc.setFontSize(8.5);
            doc.text(`CGPA: ${edu.cgpa || ''}`, W - margin, y, { align: 'right' }); y += 5;
            doc.text(`${edu.degree || ''} | ${edu.year || ''}`, margin, y); y += 4;
            if (edu.puc_school) { doc.setFont('helvetica', 'bold'); doc.text(edu.puc_school, margin, y); doc.setFont('helvetica', 'normal'); doc.text(`12th: ${edu.twelfth || ''}%`, W - margin, y, { align: 'right' }); y += 5; }
            if (edu.school) { doc.setFont('helvetica', 'bold'); doc.text(edu.school, margin, y); doc.setFont('helvetica', 'normal'); doc.text(`10th: ${edu.tenth || ''}%`, W - margin, y, { align: 'right' }); y += 5; }
            y += 2;

            // Skills
            if (data.skills.length) {
              checkPage(10); modernSection('TECHNICAL SKILLS');
              doc.setFontSize(9); doc.setFont('helvetica', 'normal');
              const skillText = data.skills.join(' • ');
              wrap(doc, skillText, margin, contentW).forEach(l => { checkPage(); doc.text(l, margin, y); y += 5; });
              y += 2;
            }

            // Projects
            if (data.projects.length) {
              checkPage(12); modernSection('PROJECTS');
              data.projects.forEach(p => {
                checkPage(10);
                doc.setFontSize(9.5); doc.setFont('helvetica', 'bold');
                doc.text(`${p.title}${p.tech ? '  |  ' + p.tech : ''}`, margin, y);
                doc.setFont('helvetica', 'normal'); doc.setFontSize(8);
                doc.text(p.status === 'ongoing' ? 'In Progress' : 'Completed', W - margin, y, { align: 'right' }); y += 4.5;
                if (p.link) { doc.setTextColor(26, 35, 126); doc.text(p.link, margin, y); doc.setTextColor(0, 0, 0); y += 4; }
                if (p.description) {
                  p.description.split('\n').filter(Boolean).forEach(pt => {
                    checkPage(); doc.setFontSize(8.5);
                    wrap(doc, `• ${pt.trim()}`, margin + 2, contentW - 2).forEach(l => { doc.text(l, margin + 2, y); y += 4.5; });
                  });
                }
                y += 2;
              });
            }

            // Internships
            if (data.internships.length) {
              checkPage(12); modernSection('INTERNSHIPS & EXPERIENCE');
              data.internships.forEach(i => {
                checkPage(8);
                doc.setFontSize(9.5); doc.setFont('helvetica', 'bold');
                doc.text(`${i.role}${i.company ? ' – ' + i.company : ''}`, margin, y);
                doc.setFont('helvetica', 'normal'); doc.setFontSize(8);
                doc.text(i.duration || '', W - margin, y, { align: 'right' }); y += 5;
                if (i.description) {
                  i.description.split('\n').filter(Boolean).forEach(pt => {
                    checkPage(); doc.setFontSize(8.5);
                    wrap(doc, `• ${pt.trim()}`, margin + 2, contentW - 2).forEach(l => { doc.text(l, margin + 2, y); y += 4.5; });
                  });
                }
                y += 2;
              });
            }

            // Achievements
            if (data.achievements.length) {
              checkPage(10); modernSection('ACHIEVEMENTS & CERTIFICATIONS');
              doc.setFontSize(8.5); doc.setFont('helvetica', 'normal');
              data.achievements.forEach(a => { checkPage(); wrap(doc, `• ${a}`, margin + 2, contentW - 2).forEach(l => { doc.text(l, margin + 2, y); y += 4.5; }); });
            }

          } else if (template === 'sidebar') {
            // ── DARK SIDEBAR ──
            const sbW = 62;
            doc.setFillColor(15, 23, 42); doc.rect(0, 0, sbW, H, 'F');
            doc.setFillColor(26, 35, 60); doc.rect(0, 0, sbW, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(14); doc.setFont('helvetica', 'bold');
            const nameLines = doc.splitTextToSize((data.name || '').toUpperCase(), sbW - 10);
            let sy = 14;
            nameLines.forEach(l => { doc.text(l, sbW / 2, sy, { align: 'center' }); sy += 7; });
            doc.setFontSize(8); doc.setFont('helvetica', 'normal');
            doc.setTextColor(6, 182, 212);
            doc.text(data.objective_role || '', sbW / 2, sy + 1, { align: 'center' });

            // Sidebar sections
            const sbSection = (title, startY) => {
              doc.setFontSize(7.5); doc.setFont('helvetica', 'bold');
              doc.setTextColor(6, 182, 212);
              doc.text(title.toUpperCase(), 6, startY);
              doc.setDrawColor(6, 182, 212); doc.setLineWidth(0.3);
              doc.line(6, startY + 1.5, sbW - 6, startY + 1.5);
              return startY + 6;
            };

            let sbY = 47;
            // Contact
            sbY = sbSection('Contact', sbY);
            doc.setFontSize(7.5); doc.setFont('helvetica', 'normal'); doc.setTextColor(203, 213, 225);
            [data.email, data.phone, data.linkedin, data.github].filter(Boolean).forEach(c => {
              doc.splitTextToSize(c, sbW - 12).forEach(l => { doc.text(l, 6, sbY); sbY += 4; });
              sbY += 1;
            });
            sbY += 3;

            // Skills
            if (data.skills.length) {
              sbY = sbSection('Skills', sbY);
              doc.setFontSize(7.5); doc.setTextColor(203, 213, 225);
              data.skills.slice(0, 14).forEach(s => { doc.text(`• ${s}`, 6, sbY); sbY += 4.2; });
              sbY += 3;
            }

            // Education brief
            sbY = sbSection('Education', sbY);
            doc.setFontSize(7.5); doc.setTextColor(203, 213, 225);
            doc.setFont('helvetica', 'bold'); doc.text(edu.college || '', 6, sbY); sbY += 4;
            doc.setFont('helvetica', 'normal');
            doc.splitTextToSize(edu.degree || '', sbW - 12).forEach(l => { doc.text(l, 6, sbY); sbY += 3.8; });
            doc.text(`CGPA: ${edu.cgpa || ''}`, 6, sbY); sbY += 4;

            // Main content
            const mx = sbW + 8; const mW = W - mx - 8;
            doc.setTextColor(0, 0, 0);
            let my = 12;

            const mainSection = (title) => {
              if (my > H - 15) { doc.addPage(); doc.setFillColor(15, 23, 42); doc.rect(0, 0, sbW, H, 'F'); my = 12; }
              doc.setFontSize(11); doc.setFont('helvetica', 'bold'); doc.setTextColor(15, 23, 42);
              doc.text(title, mx, my); my += 2;
              doc.setDrawColor(6, 182, 212); doc.setLineWidth(0.5);
              doc.line(mx, my, W - 8, my); my += 5;
              doc.setTextColor(30, 30, 30);
            };

            const checkM = (needed = 8) => {
              if (my + needed > H - 12) {
                doc.addPage();
                doc.setFillColor(15, 23, 42); doc.rect(0, 0, sbW, H, 'F');
                my = 12;
              }
            };

            if (data.summary) {
              mainSection('Summary');
              doc.setFontSize(8.5); doc.setFont('helvetica', 'normal');
              wrap(doc, data.summary, mx, mW).forEach(l => { checkM(); doc.text(l, mx, my); my += 4.5; });
              my += 3;
            }

            if (data.projects.length) {
              mainSection('Projects');
              data.projects.forEach(p => {
                checkM(8);
                doc.setFontSize(9); doc.setFont('helvetica', 'bold');
                doc.text(p.title, mx, my);
                if (p.tech) { doc.setFont('helvetica', 'normal'); doc.setFontSize(7.5); doc.setTextColor(80, 80, 80); doc.text(p.tech, W - 8, my, { align: 'right' }); doc.setTextColor(30, 30, 30); }
                my += 4.5;
                if (p.description) {
                  doc.setFont('helvetica', 'normal'); doc.setFontSize(8);
                  p.description.split('\n').filter(Boolean).forEach(pt => { checkM(); wrap(doc, `• ${pt.trim()}`, mx + 2, mW - 2).forEach(l => { doc.text(l, mx + 2, my); my += 4; }); });
                }
                my += 2;
              });
            }

            if (data.internships.length) {
              mainSection('Experience');
              data.internships.forEach(i => {
                checkM(8);
                doc.setFontSize(9); doc.setFont('helvetica', 'bold');
                doc.text(`${i.role}${i.company ? ' – ' + i.company : ''}`, mx, my);
                doc.setFont('helvetica', 'normal'); doc.setFontSize(7.5); doc.setTextColor(80, 80, 80);
                doc.text(i.duration || '', W - 8, my, { align: 'right' }); doc.setTextColor(30, 30, 30); my += 4.5;
                if (i.description) {
                  doc.setFontSize(8);
                  i.description.split('\n').filter(Boolean).forEach(pt => { checkM(); wrap(doc, `• ${pt.trim()}`, mx + 2, mW - 2).forEach(l => { doc.text(l, mx + 2, my); my += 4; }); });
                }
                my += 2;
              });
            }

            if (data.achievements.length) {
              mainSection('Achievements');
              doc.setFontSize(8); doc.setFont('helvetica', 'normal');
              data.achievements.forEach(a => { checkM(); wrap(doc, `• ${a}`, mx + 2, mW - 2).forEach(l => { doc.text(l, mx + 2, my); my += 4.5; }); });
            }

          } else {
            // ── CLASSIC (default) ──
            const margin = 14; const contentW = W - margin * 2;
            doc.setTextColor(0, 0, 0);

            // Name
            doc.setFontSize(18); doc.setFont('helvetica', 'bold');
            doc.text((data.name || '').toUpperCase(), W / 2, 18, { align: 'center' });

            // Role
            if (data.objective_role) {
              doc.setFontSize(9); doc.setFont('helvetica', 'normal'); doc.setTextColor(80, 80, 80);
              doc.text(data.objective_role, W / 2, 24, { align: 'center' });
              doc.setTextColor(0, 0, 0);
            }

            // Contact line
            const contactParts = [data.city || edu.city, data.email, data.phone, data.linkedin, data.github].filter(Boolean);
            doc.setFontSize(7.5);
            doc.text(contactParts.join('  |  '), W / 2, 30, { align: 'center' });

            // Top divider
            doc.setDrawColor(0); doc.setLineWidth(0.6);
            doc.line(margin, 33, W - margin, 33);

            let y = 40;
            const checkPage = (needed = 8) => { if (y + needed > H - 12) { doc.addPage(); y = 15; } };

            const classicSection = (title) => {
              checkPage(10);
              doc.setFontSize(9.5); doc.setFont('helvetica', 'bold'); doc.setTextColor(0, 0, 0);
              doc.setFillColor(230, 230, 230); doc.rect(margin, y - 4.5, contentW, 6.5, 'F');
              doc.text(title.toUpperCase(), margin + 2, y); y += 4.5;
              doc.setFont('helvetica', 'normal');
            };

            // Summary
            if (data.summary) {
              classicSection('Summary');
              doc.setFontSize(9);
              wrap(doc, data.summary, margin, contentW).forEach(l => { checkPage(); doc.text(l, margin, y); y += 4.8; });
              y += 2;
            }

            // Education
            classicSection('Education');
            doc.setFontSize(9.5); doc.setFont('helvetica', 'bold');
            doc.text(edu.college || '', margin, y);
            doc.text(`CGPA: ${edu.cgpa || ''}`, W - margin, y, { align: 'right' }); y += 5;
            doc.setFont('helvetica', 'normal'); doc.setFontSize(9);
            doc.text(`${edu.degree || ''}  |  Sem: ${edu.sem || ''}  |  ${edu.year || ''}`, margin, y); y += 5;
            if (edu.puc_school) {
              doc.setFont('helvetica', 'bold'); doc.text(edu.puc_school, margin, y);
              doc.text(`12th (${edu.puc_stream || ''}): ${edu.twelfth || ''}%`, W - margin, y, { align: 'right' }); y += 5;
            }
            if (edu.school) {
              doc.setFont('helvetica', 'bold'); doc.text(edu.school, margin, y);
              doc.text(`10th: ${edu.tenth || ''}%`, W - margin, y, { align: 'right' }); y += 5;
            }
            doc.setFont('helvetica', 'normal'); y += 2;

            // Skills (4-col layout)
            const langs = document.getElementById('rw-langs')?.value.trim();
            const frameworks = document.getElementById('rw-frameworks')?.value.trim();
            const tools = document.getElementById('rw-tools')?.value.trim();
            const dbs = document.getElementById('rw-dbs')?.value.trim();
            const languagesKnown = document.getElementById('rw-languages-known')?.value.trim();
            const interests = document.getElementById('rw-interests')?.value.trim();
            const completedProjs = document.getElementById('rw-completed-projects')?.value.trim();

            if (langs || languagesKnown || interests || completedProjs) {
              checkPage(22);
              const cols = [
                { title: 'Languages Known', items: (languagesKnown || '').split(',').map(s => s.trim()).filter(Boolean) },
                { title: 'Interests', items: (interests || '').split(',').map(s => s.trim()).filter(Boolean) },
                { title: 'Tech Skills', items: (langs || '').split(',').map(s => s.trim()).filter(Boolean).slice(0, 6) },
                { title: 'Projects', items: (completedProjs || '').split(',').map(s => s.trim()).filter(Boolean).slice(0, 4) },
              ];
              const colW = contentW / 4;
              doc.setDrawColor(180, 180, 180); doc.setLineWidth(0.3);
              doc.rect(margin, y - 1, contentW, Math.max(...cols.map(c => c.items.length)) * 4.5 + 10, 'S');
              cols.forEach((col, ci) => {
                let cy = y + 2;
                doc.setFontSize(8); doc.setFont('helvetica', 'bold');
                doc.text(col.title, margin + ci * colW + 2, cy); cy += 5;
                doc.setFont('helvetica', 'normal'); doc.setFontSize(8);
                col.items.forEach(item => { doc.text(`• ${item}`, margin + ci * colW + 2, cy); cy += 4.5; });
              });
              y += Math.max(...cols.map(c => c.items.length)) * 4.5 + 14;
            }

            // Full skills block
            if (data.skills.length) {
              classicSection('Technical Skills');
              doc.setFontSize(9);
              if (langs) { doc.setFont('helvetica', 'bold'); doc.text('Languages: ', margin, y); doc.setFont('helvetica', 'normal'); doc.text(langs, margin + 24, y); y += 5; }
              if (frameworks) { doc.setFont('helvetica', 'bold'); doc.text('Frameworks: ', margin, y); doc.setFont('helvetica', 'normal'); doc.text(frameworks, margin + 26, y); y += 5; }
              if (tools) { doc.setFont('helvetica', 'bold'); doc.text('Tools: ', margin, y); doc.setFont('helvetica', 'normal'); doc.text(tools, margin + 14, y); y += 5; }
              if (dbs) { doc.setFont('helvetica', 'bold'); doc.text('Databases: ', margin, y); doc.setFont('helvetica', 'normal'); doc.text(dbs, margin + 23, y); y += 5; }
              y += 2;
            }

            // Projects
            if (data.projects.length) {
              classicSection('Projects');
              data.projects.forEach(p => {
                checkPage(10);
                doc.setFontSize(9.5); doc.setFont('helvetica', 'bold');
                doc.text(`• ${p.title}${p.tech ? '  |  ' + p.tech : ''}`, margin, y);
                doc.setFont('helvetica', 'normal'); doc.setFontSize(8);
                doc.setTextColor(80, 80, 80); doc.text(p.status === 'ongoing' ? '[Ongoing]' : '[Completed]', W - margin, y, { align: 'right' }); doc.setTextColor(0, 0, 0);
                y += 5;
                if (p.link) { doc.setFontSize(8); doc.setTextColor(26, 35, 126); doc.text(`  Link: ${p.link}`, margin + 3, y); doc.setTextColor(0, 0, 0); y += 4; }
                if (p.description) {
                  doc.setFontSize(8.5);
                  p.description.split('\n').filter(Boolean).forEach(pt => { checkPage(); wrap(doc, `  – ${pt.trim()}`, margin + 3, contentW - 3).forEach(l => { doc.text(l, margin + 3, y); y += 4.5; }); });
                }
                y += 2;
              });
            }

            // Internships
            if (data.internships.length) {
              classicSection('Internships & Experience');
              data.internships.forEach(i => {
                checkPage(8);
                doc.setFontSize(9.5); doc.setFont('helvetica', 'bold');
                doc.text(`• ${i.role}${i.company ? ' – ' + i.company : ''}`, margin, y);
                doc.setFont('helvetica', 'normal'); doc.setFontSize(8.5); doc.setTextColor(80, 80, 80);
                doc.text(i.duration || '', W - margin, y, { align: 'right' }); doc.setTextColor(0, 0, 0); y += 5;
                if (i.description) {
                  doc.setFontSize(8.5);
                  i.description.split('\n').filter(Boolean).forEach(pt => { checkPage(); wrap(doc, `  – ${pt.trim()}`, margin + 3, contentW - 3).forEach(l => { doc.text(l, margin + 3, y); y += 4.5; }); });
                }
                y += 2;
              });
            }

            // Achievements
            if (data.achievements.length) {
              classicSection('Achievements & Certifications');
              doc.setFontSize(9);
              data.achievements.forEach(a => { checkPage(); wrap(doc, `• ${a}`, margin, contentW).forEach(l => { doc.text(l, margin, y); y += 4.8; }); });
            }
          }

          // Save
          const filename = `${(data.name || 'Resume').replace(/\s+/g, '_')}_Resume.pdf`;
          doc.save(filename);
          toast('Downloaded!', `${filename} saved successfully`, 's');
          btn.textContent = '✅ Downloaded!';
          setTimeout(() => { btn.textContent = '⬇ Download Resume as PDF'; btn.disabled = false; }, 3000);
        } catch (e) {
          console.error('PDF error:', e);
          errEl.textContent = '❌ PDF generation failed: ' + e.message + '. Please try again.';
          errEl.classList.remove('hidden');
          btn.textContent = '⬇ Download Resume as PDF';
          btn.disabled = false;
        }
      }

      // Expose Resume Wizard functions globally so onclick attributes can call them
      window.rwInit = rwInit;
      window.rwNext = rwNext;
      window.rwGoToDashboard = rwGoToDashboard;
      window.rwSelectTemplate = rwSelectTemplate;
      window.rwAddProject = rwAddProject;
      window.rwRemoveProject = rwRemoveProject;
      window.rwAddInternship = rwAddInternship;
      window.rwRemoveInternship = rwRemoveInternship;
      window.rwLoadDashboard = rwLoadDashboard;
      window.rwGeneratePDF = rwGeneratePDF;

    })();
  </script>

  <script>
    // ═══════════════════════════════════════════════════════════
    // SKILL COURSES DATA
    // ═══════════════════════════════════════════════════════════
    const COURSES_DATA = [
      // Programming Basics
      { skill: 'Programming Basics', title: 'Python for Beginners – Full Course', url: 'https://www.youtube.com/watch?v=_uQrJ0TkZlc', ytId: '_uQrJ0TkZlc', resumeBooster: true, meta: 'ProgrammingKnowledge' },
      { skill: 'Programming Basics', title: 'Introduction to Programming', url: 'https://www.youtube.com/watch?v=zOjov-2OZ0E', ytId: 'zOjov-2OZ0E', resumeBooster: false, meta: 'Harvard / freeCodeCamp' },
      // DSA
      { skill: 'DSA', title: 'DSA Full Course – Data Structures & Algorithms', url: 'https://www.youtube.com/watch?v=8hly31xKli0', ytId: '8hly31xKli0', resumeBooster: true, meta: 'Full Playlist' },
      { skill: 'DSA', title: 'Best DSA Playlists on YouTube', url: 'https://www.youtube.com/results?search_query=best+dsa+playlist', ytId: 'a1ZgqFqZK58', resumeBooster: true, meta: 'Multiple Channels' },
      // OOP Concepts
      { skill: 'OOP Concepts', title: 'Intro to OOP – Classes & Objects', url: 'https://www.youtube.com/watch?v=e-5obm1G_FY', ytId: 'e-5obm1G_FY', resumeBooster: true, meta: 'Fundamentals' },
      { skill: 'OOP Concepts', title: 'Java OOP Concepts Playlist', url: 'https://www.youtube.com/watch?v=6T_HgnjoYwM', ytId: '6T_HgnjoYwM', resumeBooster: true, meta: 'Java OOP Full Playlist' },
      // DBMS Basics
      { skill: 'DBMS Basics', title: 'SQL & Database Concepts – Full Course', url: 'https://youtu.be/HXV3zeQKqGY?si=qpY8Ns7ed994t0NS', ytId: 'HXV3zeQKqGY', resumeBooster: true, meta: 'freeCodeCamp' },
      // Operating Systems
      { skill: 'Operating Systems', title: 'OS Basics Lecture – Gate Smashers', url: 'https://youtu.be/WJ-UaAaumNA?si=Qsot7MmanxjvHLWN', ytId: 'WJ-UaAaumNA', resumeBooster: false, meta: 'Gate Smashers' },
      // Computer Networks
      { skill: 'Computer Networks', title: 'Computer Networks Basics – Gate Smashers', url: 'https://youtu.be/JFF2vJaN0Cw?si=jAVz7df41EYG4VaN', ytId: 'JFF2vJaN0Cw', resumeBooster: false, meta: 'Gate Smashers' },
      // Git & GitHub
      { skill: 'Git & GitHub', title: 'freeCodeCamp Git & GitHub Full Course', url: 'https://youtu.be/Ez8F0nW6S-w?si=--Bo45R_GHIcyTUy', ytId: 'Ez8F0nW6S-w', resumeBooster: true, meta: 'freeCodeCamp' },
      // Basic Web Dev
      { skill: 'Basic Web Dev', title: 'HTML Full Course for Beginners', url: 'https://youtu.be/HcOc7P5BMi4?si=S4CMwTEiXT0n_lVK', ytId: 'HcOc7P5BMi4', resumeBooster: false, meta: 'freeCodeCamp' },
      { skill: 'Basic Web Dev', title: 'CSS Full Course – Beginner to Pro', url: 'https://youtu.be/kUMe1FH4CHE?si=PhNhyZl_3K1T6ueD', ytId: 'kUMe1FH4CHE', resumeBooster: false, meta: 'freeCodeCamp' },
      { skill: 'Basic Web Dev', title: 'JavaScript Full Course for Beginners', url: 'https://youtu.be/PkZNo7MFNFg?si=9h0phCxVRdGOVaPv', ytId: 'PkZNo7MFNFg', resumeBooster: false, meta: 'freeCodeCamp' },
      // Basic Backend
      { skill: 'Basic Backend', title: 'Flask Full Course – Python Web Dev', url: 'https://www.youtube.com/watch?v=MwZwr5Tvyxo', ytId: 'MwZwr5Tvyxo', resumeBooster: false, meta: 'Code With Josh' },
      { skill: 'Basic Backend', title: 'REST API Tutorial – Full Guide', url: 'https://youtu.be/XGa4onZP66Q?si=BExVVES40KCpOfT4', ytId: 'XGa4onZP66Q', resumeBooster: false, meta: 'freeCodeCamp' },
      // System Design
      { skill: 'System Design', title: 'System Design Introduction', url: 'https://youtu.be/CuQmQpvw04I?si=H8EsTmpWF80HduTu', ytId: 'CuQmQpvw04I', resumeBooster: false, meta: 'System Design Primer' },
      // Problem-Solving
      { skill: 'Problem-Solving', title: 'Competitive Programming & Problem Solving', url: 'https://youtu.be/wkxZFLkVBvI?si=vtxDBsOdPHP3o93i', ytId: 'wkxZFLkVBvI', resumeBooster: true, meta: 'Competitive Coding' },
      // Debugging Skills
      { skill: 'Debugging Skills', title: 'Debugging Concepts – Full Overview', url: 'https://youtu.be/WHmapcIjCTQ?si=k1SU3WYldmd5f5Xs', ytId: 'WHmapcIjCTQ', resumeBooster: false, meta: 'Dev Skills' },
      // Clean Code
      { skill: 'Clean Code Practices', title: 'Clean Code Basics – Best Practices', url: 'https://youtu.be/626BcUO84og?si=SXk8GAhJl04wChEz', ytId: '626BcUO84og', resumeBooster: false, meta: 'Dev Best Practices' },
      // IDEs / Editors
      { skill: 'IDEs / Editors', title: 'VS Code Tutorial – Complete Guide', url: 'https://youtu.be/YIqF5STcc0Q?si=BIE0g8YbPlLJ-fBy', ytId: 'YIqF5STcc0Q', resumeBooster: false, meta: 'freeCodeCamp' },
      // Linux / Command Line
      { skill: 'Linux / Command Line', title: 'Linux Command Line Tutorial', url: 'https://youtu.be/4FPiPcEhjYw?si=iZqSGrBzGMqHjqOp', ytId: '4FPiPcEhjYw', resumeBooster: false, meta: 'Linux Fundamentals' },
      // SDLC
      { skill: 'SDLC', title: 'Software Development Life Cycle Overview', url: 'https://youtu.be/8xYdIZO4bPg?si=8CyR5h6ZtVSTB1CA', ytId: '8xYdIZO4bPg', resumeBooster: false, meta: 'Engineering Concepts' },
      // Testing Basics
      { skill: 'Testing Basics', title: 'Software Testing Fundamentals', url: 'https://youtu.be/E2t5XbWwj7I?si=bIf2zgIbwlLcoHcD', ytId: 'E2t5XbWwj7I', resumeBooster: false, meta: 'QA Basics' },
      // Basic Cloud
      { skill: 'Basic Cloud Awareness', title: 'AWS / Azure Cloud Intro Course', url: 'https://youtu.be/BSGcQi2WNPg?si=soAJaNnop4YysPnI', ytId: 'BSGcQi2WNPg', resumeBooster: true, meta: 'Cloud Fundamentals' },
      // API Usage
      { skill: 'API Usage', title: 'Postman & REST API Tutorial', url: 'https://youtu.be/lId_LdQ8wXU?si=G-Qm3geEwiD9QPUd', ytId: 'lId_LdQ8wXU', resumeBooster: false, meta: 'API Testing' },
      // Security
      { skill: 'Security Basics', title: 'Web Security Basics – Full Course', url: 'https://youtu.be/3Kq1MIfTWCE?si=CgON51tAPI-VU6sR', ytId: '3Kq1MIfTWCE', resumeBooster: false, meta: 'Cyber Security Intro' },
    ];

    let _courseFilter = 'all';

    function ytThumb(ytId) {
      return `https://img.youtube.com/vi/${ytId}/mqdefault.jpg`;
    }

    function setCourseFilter(filter, btn) {
      _courseFilter = filter;
      document.querySelectorAll('.cf-btn').forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');
      renderCourses();
    }

    function filterCourses() { renderCourses(); }

    function renderCourses() {
      const q = (document.getElementById('courses-search')?.value || '').toLowerCase();
      let data = COURSES_DATA;

      if (_courseFilter === 'resume') {
        data = data.filter(c => c.resumeBooster);
      } else if (_courseFilter !== 'all') {
        data = data.filter(c => c.skill === _courseFilter);
      }
      if (q) {
        data = data.filter(c =>
          c.title.toLowerCase().includes(q) ||
          c.skill.toLowerCase().includes(q) ||
          c.meta.toLowerCase().includes(q)
        );
      }

      const listing = document.getElementById('courses-listing');
      if (!listing) return;

      if (data.length === 0) {
        listing.innerHTML = '<div class="courses-empty">🔍 No courses found. Try a different filter or search term.</div>';
        return;
      }

      // Group by skill
      const groups = {};
      data.forEach(c => {
        if (!groups[c.skill]) groups[c.skill] = [];
        groups[c.skill].push(c);
      });

      let html = '';
      for (const [skill, courses] of Object.entries(groups)) {
        html += `<div class="courses-skill-group">
        <div class="courses-skill-title">${skill}</div>
        <div class="courses-grid">`;
        courses.forEach(c => {
          const ribbon = c.resumeBooster
            ? `<div class="resume-badge-ribbon">🔥 Resume Booster</div>` : '';
          html += `
        <a class="course-card${c.resumeBooster ? ' resume-booster' : ''}" href="${c.url}" target="_blank" rel="noopener">
          <div class="course-thumb">
            <img src="${ytThumb(c.ytId)}" alt="${c.title}" loading="lazy"
              onerror="this.src='https://img.youtube.com/vi/${c.ytId}/hqdefault.jpg'">
            <div class="course-thumb-overlay">
              <div class="play-btn">▶</div>
            </div>
            ${ribbon}
          </div>
          <div class="course-info">
            <div class="course-skill-tag">${c.skill}</div>
            <div class="course-title">${c.title}</div>
            <div class="course-meta">
              <div class="course-yt-label">▶ YouTube</div>
              <div class="dot"></div>
              <span>${c.meta}</span>
              ${c.resumeBooster ? '<div class="dot"></div><span style="color:var(--warning);font-weight:700;">🔥 Resume Booster</span>' : ''}
            </div>
          </div>
        </a>`;
        });
        html += `</div></div>`;
      }
      listing.innerHTML = html;
    }

    // Hook into go() for courses
    const _origGo = window.go || null;
    // patch go for courses init
    document.addEventListener('DOMContentLoaded', () => {
      // render once page loads
      renderCourses();
    });
  </script>


  <!-- ═══ PLACEMENT COACH CHATBOT ═══ -->
  <style>
    #pc-toggle {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 62px;
      height: 62px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4f8ef7, #8b5cf6);
      color: #fff;
      font-size: 26px;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 28px rgba(79, 142, 247, 0.45);
      z-index: 9998;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }

    #pc-toggle:hover {
      transform: scale(1.08);
    }

    #pc-panel {
      position: fixed;
      bottom: 100px;
      right: 24px;
      width: 420px;
      max-width: calc(100vw - 48px);
      height: 580px;
      max-height: calc(100vh - 120px);
      background: #0d1424;
      border: 1px solid #1e2d48;
      border-radius: 18px;
      box-shadow: 0 24px 64px rgba(0, 0, 0, 0.6);
      z-index: 9997;
      display: none;
      flex-direction: column;
      overflow: hidden;
      animation: fadeUp 0.25s ease;
    }

    #pc-header {
      background: linear-gradient(135deg, #4f8ef7, #8b5cf6);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    #pc-header .pc-title {
      color: #fff;
      font-weight: 700;
      font-size: 15px;
    }

    #pc-header .pc-sub {
      color: rgba(255, 255, 255, 0.75);
      font-size: 11px;
    }

    #pc-close {
      background: none;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      padding: 4px;
      border-radius: 6px;
    }

    #pc-close:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    #pc-tabs {
      display: flex;
      gap: 6px;
      padding: 10px 12px;
      background: #070b14;
      border-bottom: 1px solid #1e2d48;
      flex-shrink: 0;
    }

    .pc-tab {
      flex: 1;
      padding: 7px 4px;
      border-radius: 8px;
      border: 1px solid #1e2d48;
      background: #0d1424;
      color: #8da4c8;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      transition: all 0.18s;
    }

    .pc-tab:hover {
      background: #1e2d48;
      color: #e8f0fe;
    }

    .pc-tab.active {
      background: linear-gradient(135deg, #4f8ef7, #8b5cf6);
      color: #fff;
      border-color: transparent;
    }

    #pc-messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: #070b14;
    }

    #pc-messages::-webkit-scrollbar {
      width: 4px;
    }

    #pc-messages::-webkit-scrollbar-thumb {
      background: #1e2d48;
      border-radius: 4px;
    }

    .pc-msg {
      max-width: 85%;
      padding: 10px 14px;
      border-radius: 14px;
      font-size: 13.5px;
      line-height: 1.55;
      word-wrap: break-word;
    }

    .pc-msg.user {
      background: linear-gradient(135deg, #4f8ef7, #6366f1);
      color: #fff;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .pc-msg.bot {
      background: #1a2540;
      color: #e8f0fe;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .pc-msg.bot b {
      color: #4f8ef7;
    }

    .pc-typing {
      align-self: flex-start;
      background: #1a2540;
      border-radius: 14px;
      padding: 10px 16px;
    }

    .pc-typing span {
      display: inline-block;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #8da4c8;
      margin: 0 2px;
      animation: pcBounce 1.2s infinite;
    }

    .pc-typing span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .pc-typing span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes pcBounce {

      0%,
      60%,
      100% {
        transform: translateY(0)
      }

      30% {
        transform: translateY(-6px)
      }
    }

    #pc-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 8px 12px;
      background: #070b14;
      flex-shrink: 0;
    }

    .pc-chip {
      padding: 5px 12px;
      border-radius: 20px;
      background: #1a2540;
      color: #8da4c8;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid #1e2d48;
      transition: all 0.15s;
      white-space: nowrap;
    }

    .pc-chip:hover {
      background: #4f8ef7;
      color: #fff;
      border-color: #4f8ef7;
    }

    #pc-input-row {
      display: flex;
      gap: 8px;
      padding: 10px 12px;
      background: #0d1424;
      border-top: 1px solid #1e2d48;
      flex-shrink: 0;
    }

    #pc-input {
      flex: 1;
      padding: 9px 14px;
      background: #070b14;
      border: 1px solid #1e2d48;
      border-radius: 10px;
      color: #e8f0fe;
      font-size: 13px;
      outline: none;
      font-family: inherit;
    }

    #pc-input:focus {
      border-color: #4f8ef7;
    }

    #pc-send {
      padding: 9px 16px;
      background: linear-gradient(135deg, #4f8ef7, #8b5cf6);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: opacity 0.2s;
    }

    #pc-send:hover {
      opacity: 0.88;
    }

    #pc-send:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    #pc-quiz {
      flex: 1;
      overflow-y: auto;
      padding: 14px;
      background: #070b14;
      display: none;
      flex-direction: column;
      gap: 14px;
    }

    #pc-quiz::-webkit-scrollbar {
      width: 4px;
    }

    #pc-quiz::-webkit-scrollbar-thumb {
      background: #1e2d48;
      border-radius: 4px;
    }

    .pq-question {
      background: #1a2540;
      border-radius: 12px;
      padding: 14px;
    }

    .pq-q-text {
      font-size: 14px;
      font-weight: 600;
      color: #e8f0fe;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .pq-q-num {
      font-size: 11px;
      color: #4f8ef7;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .pq-opts {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .pq-opt {
      padding: 9px 14px;
      border-radius: 9px;
      border: 1px solid #1e2d48;
      background: #0d1424;
      color: #e8f0fe;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
      text-align: left;
    }

    .pq-opt:hover:not(:disabled) {
      border-color: #4f8ef7;
      background: #1a2540;
    }

    .pq-opt.correct {
      background: rgba(34, 197, 94, 0.15);
      border-color: #22c55e;
      color: #22c55e;
    }

    .pq-opt.wrong {
      background: rgba(244, 63, 94, 0.15);
      border-color: #f43f5e;
      color: #f43f5e;
    }

    .pq-opt.reveal {
      border-color: #22c55e;
      color: #22c55e;
      background: rgba(34, 197, 94, 0.08);
    }

    .pq-score-bar {
      background: #1a2540;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 1px solid #1e2d48;
    }

    .pq-score-num {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #4f8ef7, #22c55e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    #pc-quiz-header {
      display: none;
      background: #0d1424;
      border-bottom: 1px solid #1e2d48;
      padding: 8px 14px;
      flex-shrink: 0;
    }

    .qh-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #8da4c8;
    }

    .qh-score {
      color: #22c55e;
      font-weight: 700;
    }

    .pc-loading {
      text-align: center;
      padding: 30px;
      color: #8da4c8;
      font-size: 14px;
    }

    .pc-loader {
      width: 32px;
      height: 32px;
      border: 3px solid #1e2d48;
      border-top-color: #4f8ef7;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 12px;
    }
  </style>

  <button id="pc-toggle" onclick="pcToggle()" title="Placement Coach AI">&#129302;</button>

  <div id="pc-panel">
    <div id="pc-header">
      <div>
        <div class="pc-title">&#127891; Placement Coach</div>
        <div class="pc-sub">AI-powered career assistant</div>
      </div>
      <button id="pc-close" onclick="pcToggle()">&#x2715;</button>
    </div>
    <div id="pc-tabs">
      <div class="pc-tab active" onclick="pcSetMode('chat')" id="pctab-chat">&#128172; Chat</div>
      <div class="pc-tab" onclick="pcSetMode('aptitude')" id="pctab-aptitude">&#129504; Aptitude</div>
      <div class="pc-tab" onclick="pcSetMode('technical')" id="pctab-technical">&#128187; Technical</div>
      <div class="pc-tab" onclick="pcSetMode('hr')" id="pctab-hr">&#127908; HR</div>
    </div>
    <div id="pc-quiz-header">
      <div class="qh-row"><span id="pc-q-num">Q 1/10</span><span class="qh-score">Score: <span id="pc-q-score">0</span>
          / <span id="pc-q-total">0</span></span></div>
    </div>
    <div id="pc-messages"></div>
    <div id="pc-chips"></div>
    <div id="pc-quiz"></div>
    <div id="pc-input-row">
      <input id="pc-input" type="text" placeholder="Ask anything about placements...">
      <button id="pc-send">&#10148;</button>
    </div>
  </div>

  <script>
    (function () {
      var pcOpen = false;
      var pcMode = 'chat';
      var pcHistory = [];
      var pcQuizData = [];
      var pcQIndex = 0;
      var pcScore = 0;
      var pcAnswered = false;

      var CHIPS = {
        chat: ['Top hiring companies', 'How to crack TCS NQT', 'Resume tips', 'DSA roadmap', 'Salary packages', 'Mock interview tips'],
        aptitude: ['Start Aptitude Quiz', 'Number Series', 'Time and Work', 'Percentages', 'Logical Reasoning'],
        technical: ['Start Technical Quiz', 'Arrays & Strings', 'DBMS Concepts', 'OS Interview Qs', 'SQL Queries'],
        hr: ['Start HR Quiz', 'Tell me about yourself', 'Strengths & Weaknesses', 'Why hire you', 'Salary negotiation']
      };

      window.pcToggle = function () {
        pcOpen = !pcOpen;
        var panel = document.getElementById('pc-panel');
        panel.style.display = pcOpen ? 'flex' : 'none';
        if (pcOpen && document.getElementById('pc-messages').children.length === 0) {
          pcBotMsg('Hi! I am your Placement Coach. I can help with:\n\n- Company info & interview prep\n- Aptitude & Technical quizzes\n- Resume tips & HR questions\n- Salary trends\n\nWhat would you like to explore?');
          pcShowChips(CHIPS.chat);
        }
        if (pcOpen) { setTimeout(function () { document.getElementById('pc-input').focus(); }, 200); }
      };

      window.pcSetMode = function (mode) {
        pcMode = mode;
        ['chat', 'aptitude', 'technical', 'hr'].forEach(function (m) {
          document.getElementById('pctab-' + m).classList.toggle('active', m === mode);
        });
        var showChat = mode === 'chat';
        document.getElementById('pc-messages').style.display = showChat ? 'flex' : 'none';
        document.getElementById('pc-chips').style.display = showChat ? 'flex' : 'none';
        document.getElementById('pc-quiz').style.display = showChat ? 'none' : 'flex';
        document.getElementById('pc-input-row').style.display = showChat ? 'flex' : 'none';
        document.getElementById('pc-quiz-header').style.display = 'none';
        if (!showChat) { pcStartQuiz(mode); } else { pcShowChips(CHIPS.chat); }
      };

      function pcSend() {
        var input = document.getElementById('pc-input');
        var msg = input.value.trim();
        if (!msg) return;
        input.value = '';
        document.getElementById('pc-send').disabled = true;
        pcUserMsg(msg);
        pcShowChips([]);
        pcHistory.push({ role: 'user', content: msg });
        var lower = msg.toLowerCase();
        if (lower.indexOf('aptitude quiz') !== -1 || lower.indexOf('start aptitude') !== -1) { pcSetMode('aptitude'); document.getElementById('pc-send').disabled = false; return; }
        if (lower.indexOf('technical quiz') !== -1 || lower.indexOf('start technical') !== -1) { pcSetMode('technical'); document.getElementById('pc-send').disabled = false; return; }
        if (lower.indexOf('hr quiz') !== -1 || lower.indexOf('start hr') !== -1) { pcSetMode('hr'); document.getElementById('pc-send').disabled = false; return; }
        var typingId = pcShowTyping();
        fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: msg, history: pcHistory.slice(-12) })
        }).then(function (r) { return r.json(); }).then(function (data) {
          pcRemoveTyping(typingId);
          var reply = data.reply || data.error || 'Sorry, something went wrong.';
          pcBotMsg(reply);
          pcHistory.push({ role: 'assistant', content: reply });
          pcShowChips(CHIPS[pcMode] || CHIPS.chat);
          document.getElementById('pc-send').disabled = false;
        }).catch(function () {
          pcRemoveTyping(typingId);
          pcBotMsg('Connection error. Please try again.');
          document.getElementById('pc-send').disabled = false;
        });
      }

      function pcStartQuiz(mode) {
        var quizEl = document.getElementById('pc-quiz');
        quizEl.innerHTML = '<div class="pc-loading"><div class="pc-loader"></div>Generating questions with AI...</div>';
        document.getElementById('pc-quiz-header').style.display = 'none';
        pcQuizData = []; pcQIndex = 0; pcScore = 0; pcAnswered = false;
        var configs = {
          aptitude: { categories: ['Aptitude', 'Logical Reasoning'], subTopics: ['Number Series', 'Time and Work', 'Percentages', 'Data Interpretation'] },
          technical: { categories: ['Technical', 'Programming'], subTopics: ['Data Structures', 'Algorithms', 'DBMS', 'Operating Systems', 'OOP', 'SQL'] },
          hr: { categories: ['HR Interview', 'Soft Skills'], subTopics: ['Communication', 'Behavioral Questions', 'Leadership', 'Teamwork'] }
        };
        var cfg = configs[mode] || configs.aptitude;
        fetch('/api/quiz/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ categories: cfg.categories, subTopics: cfg.subTopics, questionCount: 10, difficulty: 'mixed' })
        }).then(function (r) { return r.json(); }).then(function (data) {
          if (!data.success || !data.questions || !data.questions.length) throw new Error(data.error || 'No questions');
          pcQuizData = data.questions;
          pcRenderQuestion();
        }).catch(function (e) {
          quizEl.innerHTML = '<div class="pc-loading"><div style="font-size:28px;margin-bottom:8px;">⚠️</div><div style="color:#f43f5e;margin-bottom:12px;">Failed: ' + e.message + '</div><button onclick="pcSetMode(\'' + mode + '\')" style="padding:8px 20px;background:#4f8ef7;color:#fff;border:none;border-radius:8px;cursor:pointer;">Retry</button></div>';
        });
      }

      function pcRenderQuestion() {
        var q = pcQuizData[pcQIndex];
        if (!q) { pcShowResult(); return; }
        pcAnswered = false;
        var quizEl = document.getElementById('pc-quiz');
        document.getElementById('pc-quiz-header').style.display = 'block';
        document.getElementById('pc-q-num').textContent = 'Q ' + (pcQIndex + 1) + ' / ' + pcQuizData.length;
        document.getElementById('pc-q-score').textContent = pcScore;
        document.getElementById('pc-q-total').textContent = pcQIndex;
        var optsHtml = '';
        for (var i = 0; i < q.options.length; i++) {
          optsHtml += '<button class="pq-opt" id="pqo-' + i + '" data-idx="' + i + '">' + String.fromCharCode(65 + i) + '. ' + q.options[i] + '</button>';
        }
        quizEl.innerHTML = '<div class="pq-question"><div class="pq-q-num">Question ' + (pcQIndex + 1) + ' of ' + pcQuizData.length + ' &bull; ' + (q.topic || '') + '</div><div class="pq-q-text">' + q.question + '</div><div class="pq-opts" id="pq-opts">' + optsHtml + '</div></div>';
        quizEl.scrollTop = 0;
        // Wire up option clicks
        var opts = quizEl.querySelectorAll('.pq-opt');
        for (var j = 0; j < opts.length; j++) {
          opts[j].addEventListener('click', function () { pcAnswer(parseInt(this.getAttribute('data-idx'))); });
        }
      }

      window.pcAnswer = function (idx) {
        if (pcAnswered) return;
        pcAnswered = true;
        var q = pcQuizData[pcQIndex];
        var correct = q.correctAnswer;
        var isRight = idx === correct;
        if (isRight) pcScore++;
        for (var i = 0; i < q.options.length; i++) {
          var btn = document.getElementById('pqo-' + i);
          if (!btn) continue;
          btn.disabled = true;
          if (i === correct) btn.classList.add('reveal');
          if (i === idx && !isRight) btn.classList.add('wrong');
          if (i === idx && isRight) { btn.classList.remove('reveal'); btn.classList.add('correct'); }
        }
        document.getElementById('pc-q-score').textContent = pcScore;
        document.getElementById('pc-q-total').textContent = pcQIndex + 1;
        var quizEl = document.getElementById('pc-quiz');
        var nextDiv = document.createElement('div');
        nextDiv.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:8px;';
        var feedback = isRight ? '<span style="color:#22c55e;font-weight:700;">✅ Correct!</span>' : '<span style="color:#f43f5e;font-weight:700;">❌ Wrong</span>';
        var nextLabel = (pcQIndex + 1 < pcQuizData.length) ? 'Next →' : 'See Results';
        nextDiv.innerHTML = feedback + '<button onclick="pcNextQ()" style="padding:8px 20px;background:linear-gradient(135deg,#4f8ef7,#8b5cf6);color:#fff;border:none;border-radius:9px;cursor:pointer;font-size:13px;font-weight:700;">' + nextLabel + '</button>';
        quizEl.querySelector('.pq-question').appendChild(nextDiv);
      };

      window.pcNextQ = function () {
        pcQIndex++;
        if (pcQIndex >= pcQuizData.length) { pcShowResult(); } else { pcRenderQuestion(); }
      };

      function pcShowResult() {
        var quizEl = document.getElementById('pc-quiz');
        var pct = Math.round((pcScore / pcQuizData.length) * 100);
        var emoji = pct >= 80 ? '🏆' : pct >= 60 ? '👍' : pct >= 40 ? '📚' : '💪';
        var label = pct >= 80 ? 'Excellent!' : pct >= 60 ? 'Good Job!' : pct >= 40 ? 'Keep Practicing' : 'Need More Practice';
        var clr = pct >= 80 ? '#22c55e' : pct >= 60 ? '#4f8ef7' : pct >= 40 ? '#f59e0b' : '#f43f5e';
        document.getElementById('pc-quiz-header').style.display = 'none';
        var modeRef = pcMode;
        quizEl.innerHTML = '<div class="pq-score-bar"><div style="font-size:40px;margin-bottom:8px;">' + emoji + '</div><div class="pq-score-num">' + pcScore + ' / ' + pcQuizData.length + '</div><div style="font-size:14px;color:' + clr + ';font-weight:700;margin:6px 0;">' + label + ' — ' + pct + '%</div></div><div style="display:flex;flex-direction:column;gap:8px;"><button onclick="pcSetMode(\'' + modeRef + '\')" style="padding:10px;background:linear-gradient(135deg,#4f8ef7,#8b5cf6);color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:14px;font-weight:700;">🔄 Retry Quiz</button><button onclick="pcSetMode(\'chat\')" style="padding:10px;background:#1a2540;color:#e8f0fe;border:1px solid #1e2d48;border-radius:10px;cursor:pointer;font-size:14px;">💬 Back to Chat</button></div>';
      }

      window.pcChipClick = function (text) {
        document.getElementById('pc-input').value = text;
        pcSend();
      };

      function pcShowChips(chips) {
        var el = document.getElementById('pc-chips');
        var html = '';
        for (var i = 0; i < chips.length; i++) {
          html += '<div class="pc-chip" onclick="pcChipClick(\'' + chips[i].replace(/'/g, '') + '\')">' + chips[i] + '</div>';
        }
        el.innerHTML = html;
      }

      function pcUserMsg(text) {
        var el = document.getElementById('pc-messages');
        var d = document.createElement('div');
        d.className = 'pc-msg user';
        d.textContent = text;
        el.appendChild(d);
        el.scrollTop = el.scrollHeight;
      }

      function pcBotMsg(text) {
        var el = document.getElementById('pc-messages');
        var d = document.createElement('div');
        d.className = 'pc-msg bot';
        var html = text
          .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
          .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
          .replace(/\n/g, '<br>');
        d.innerHTML = html;
        el.appendChild(d);
        el.scrollTop = el.scrollHeight;
      }

      function pcShowTyping() {
        var el = document.getElementById('pc-messages');
        var id = 'pct-' + Date.now();
        var d = document.createElement('div');
        d.className = 'pc-typing'; d.id = id;
        d.innerHTML = '<span></span><span></span><span></span>';
        el.appendChild(d);
        el.scrollTop = el.scrollHeight;
        return id;
      }

      function pcRemoveTyping(id) {
        var el = document.getElementById(id);
        if (el) el.remove();
      }

      // Wire up event listeners AFTER all functions are defined
      var pcSendBtn = document.getElementById('pc-send');
      var pcInputEl = document.getElementById('pc-input');
      if (pcSendBtn) pcSendBtn.addEventListener('click', pcSend);
      if (pcInputEl) pcInputEl.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') pcSend();
      });

    })();
  </script>
</body>

</html>